

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>immunogrep_read_file &mdash; IGREP 1.0.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="IGREP 1.0.0 documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> IGREP</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../Variables.html">Global Variables</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Variables.html#list-of-variables">List of variables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Functions.html">Useful Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Functions.html#contents">Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Functions.html#insidefunc">Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../IGfile.html">Immunogrepfile</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../IGfile.html#variables">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../IGfile.html#module-immunogrep_read_file">Header Extraction Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../IGfile.html#immunogrep-classes">Immunogrep Classes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../VHVLPairing.html">VH-VL Pairing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../VHVLPairing.html#contents">Contents</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">IGREP</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Module code</a> &raquo;</li>
      
    <li>immunogrep_read_file</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for immunogrep_read_file</h1><div class="highlight"><pre>
<span class="c">#~~~~Updated on 6/16/2015 to support reading IMGT files (previous version is 213)~~~#</span>

<span class="c">#~~~~Updated on 5/6/2015 to allow for field names to be custom passed into initialization (previous version is 207)~~~#</span>


<span class="c">#~~~~beta version updated on 06/06/2014~~~~#</span>
<span class="c">#~~~~beta version where FASTA and FASTQ reading changed updated on 3/19/2015 (previous beta version is 186) ~~~~~</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="k">try</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
<span class="k">except</span><span class="p">:</span>
	<span class="k">print</span> <span class="s">&quot;BIO NOT INSTALLED!!!READING FASTA AND FASTQ FILES WILL BE AFFECTED&quot;</span>
	
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>


<span class="c">#import immunogrep_useful_functions as useful#import removeNoneVals</span>
<span class="c">#from immunogrep_useful_functions import fieldsForAnnotatingAb</span>
<span class="c">#from immunogrep_useful_functions import removeFileExtension</span>

<span class="c"># +++++++++++++++++++++++++++++</span>
<span class="c"># +Importing Global variables +</span>
<span class="c"># +++++++++++++++++++++++++++++ </span>
<span class="kn">from</span> <span class="nn">immunogrep_global_variables</span> <span class="kn">import</span> <span class="n">descriptor_symbol</span>
<span class="kn">from</span> <span class="nn">immunogrep_global_variables</span> <span class="kn">import</span> <span class="n">fasta_file_delimiter</span>
<span class="kn">from</span> <span class="nn">immunogrep_global_variables</span> <span class="kn">import</span> <span class="n">description_var</span>
<span class="kn">from</span> <span class="nn">immunogrep_global_variables</span> <span class="kn">import</span> <span class="n">translation_var</span>
<span class="kn">from</span> <span class="nn">immunogrep_global_variables</span> <span class="kn">import</span> <span class="n">annotationExt</span>
<span class="kn">from</span> <span class="nn">immunogrep_global_variables</span> <span class="kn">import</span> <span class="n">analysisExt</span>
<span class="kn">from</span> <span class="nn">immunogrep_global_variables</span> <span class="kn">import</span> <span class="n">queryExt</span>
<span class="kn">from</span> <span class="nn">immunogrep_global_variables</span> <span class="kn">import</span> <span class="n">IFExt</span>
<span class="kn">from</span> <span class="nn">immunogrep_global_variables</span> <span class="kn">import</span> <span class="n">idIdentifier</span>
<span class="kn">from</span> <span class="nn">immunogrep_global_variables</span> <span class="kn">import</span> <span class="n">listofextension</span>

<span class="kn">from</span> <span class="nn">immunogrep_global_variables</span> <span class="kn">import</span> <span class="n">imgt_files_info</span>




<span class="c"># +++++++++++++++++++</span>
<span class="c"># + File variable   +</span>
<span class="c"># +++++++++++++++++++</span>
<span class="n">current_filetypes</span><span class="o">=</span><span class="p">{</span>
	<span class="s">&#39;FASTA&#39;</span><span class="p">:[</span><span class="s">&#39;fna&#39;</span><span class="p">,</span><span class="s">&#39;fasta&#39;</span><span class="p">],</span>
	<span class="s">&#39;TAB&#39;</span><span class="p">:[</span><span class="s">&#39;txt&#39;</span><span class="p">,</span><span class="s">&#39;tab&#39;</span><span class="p">],</span>
	<span class="s">&#39;CSV&#39;</span><span class="p">:[</span><span class="s">&#39;csv&#39;</span><span class="p">],</span>
	<span class="s">&#39;FASTQ&#39;</span><span class="p">:[</span><span class="s">&#39;fastq&#39;</span><span class="p">],</span>
	<span class="s">&#39;JSON&#39;</span><span class="p">:[</span><span class="s">&#39;json&#39;</span><span class="p">,</span><span class="s">&#39;annotation&#39;</span><span class="p">,</span><span class="s">&#39;analysis&#39;</span><span class="p">,</span><span class="s">&#39;query&#39;</span><span class="p">,</span><span class="s">&#39;iffile&#39;</span><span class="p">,</span><span class="s">&#39;IFFile&#39;</span><span class="p">],</span>
	<span class="s">&#39;DELIM&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;delim&#39;</span><span class="p">],</span>	
	<span class="s">&#39;IMGT&#39;</span><span class="p">:[</span><span class="s">&#39;imgt&#39;</span><span class="p">]</span>
<span class="p">}</span>

<span class="c">#LAMBDA FUNCTION FOR RECOMBINATION FIELD IS A HACK TO ENSURE THAT ONLY FILE ONE IS REALLY REQUIRED </span>
<span class="c">#FILE 1 WILL ALWAYS BE REQUIRED </span>
<span class="n">imgt_db_translator</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;ANALYSIS_NAME&quot;</span><span class="p">:</span><span class="s">&#39;IMGT&#39;</span><span class="p">,</span>
	<span class="s">&quot;RECOMBINATION_FIELD&quot;</span><span class="p">:{</span>		
		<span class="s">&quot;LAMBDA_FUNCTION&quot;</span><span class="p">:</span><span class="s">&quot;lambda x: &#39;VDJ&#39; if x[&#39;V-D-J-REGION_3&#39;] else (&#39;VJ&#39; if x[&#39;V-J-REGION_3&#39;] else (&#39;&#39; if not(x[&#39;V-GENE and allele_1&#39;]) else (&#39;VDJ&#39; if (&#39;IGHV&#39; in x[&#39;V-GENE and allele_1&#39;] or &#39;TRBV&#39; in x[&#39;V-GENE and allele_1&#39;]) else &#39;VJ&#39;)))&quot;</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="s">&quot;FIELDS_UPDATE&quot;</span><span class="p">:{</span>
		<span class="n">idIdentifier</span><span class="p">:</span><span class="n">idIdentifier</span><span class="p">,</span>
		<span class="s">&#39;COMMAND&#39;</span><span class="p">:</span><span class="s">&#39;COMMAND&#39;</span><span class="p">,</span>
		<span class="s">&#39;SEQUENCE_HEADER&#39;</span><span class="p">:</span><span class="s">&#39;Sequence ID_1&#39;</span><span class="p">,</span>		
		<span class="s">&#39;SEQUENCE&#39;</span><span class="p">:</span><span class="s">&#39;Sequence_1&#39;</span><span class="p">,</span>
		<span class="s">&#39;STRAND&#39;</span><span class="p">:</span><span class="s">&#39;Orientation_1&#39;</span><span class="p">,</span>
		<span class="s">&#39;PRODUCTIVE&#39;</span><span class="p">:</span><span class="s">&#39;Functionality_1&#39;</span><span class="p">,</span>
		<span class="s">&#39;VREGION.VGENE_SCORES&#39;</span><span class="p">:</span><span class="s">&#39;V-REGION score_1&#39;</span><span class="p">,</span>		
		<span class="s">&#39;JREGION.JGENE_SCORES&#39;</span><span class="p">:</span><span class="s">&#39;J-REGION score_1&#39;</span><span class="p">,</span>		
		<span class="s">&#39;NOTES&#39;</span><span class="p">:</span><span class="s">&#39;Functionality comment_1&#39;</span><span class="p">,</span>
		
		<span class="s">&#39;VREGION.CDR1.NT&#39;</span><span class="p">:</span><span class="s">&#39;CDR1-IMGT_3&#39;</span><span class="p">,</span>
		<span class="s">&#39;GAPPED.VREGION.CDR1.NT&#39;</span><span class="p">:</span><span class="s">&#39;CDR1-IMGT_2&#39;</span><span class="p">,</span>
		
		<span class="s">&#39;VREGION.CDR1.AA&#39;</span><span class="p">:</span><span class="s">&#39;CDR1-IMGT_5&#39;</span><span class="p">,</span>
		<span class="s">&#39;GAPPED.VREGION.CDR1.AA&#39;</span><span class="p">:</span><span class="s">&#39;CDR1-IMGT_4&#39;</span><span class="p">,</span>
		
		<span class="s">&#39;VREGION.CDR2.NT&#39;</span><span class="p">:</span><span class="s">&#39;CDR2-IMGT_3&#39;</span><span class="p">,</span>
		<span class="s">&#39;GAPPED.VREGION.CDR2.NT&#39;</span><span class="p">:</span><span class="s">&#39;CDR2-IMGT_2&#39;</span><span class="p">,</span>
		
		<span class="s">&#39;VREGION.CDR2.AA&#39;</span><span class="p">:</span><span class="s">&#39;CDR2-IMGT_5&#39;</span><span class="p">,</span>
		<span class="s">&#39;GAPPED.VREGION.CDR2.AA&#39;</span><span class="p">:</span><span class="s">&#39;CDR2-IMGT_4&#39;</span><span class="p">,</span>
		
		<span class="s">&#39;CDR3.NT&#39;</span><span class="p">:</span><span class="s">&#39;CDR3-IMGT_3&#39;</span><span class="p">,</span>		
		<span class="s">&#39;GAPPED.CDR3.NT&#39;</span><span class="p">:</span><span class="s">&#39;CDR3-IMGT_2&#39;</span><span class="p">,</span>				
		
		<span class="s">&#39;CDR3.AA&#39;</span><span class="p">:</span><span class="s">&#39;CDR3-IMGT_5&#39;</span><span class="p">,</span>
		<span class="s">&#39;GAPPED.CDR3.AA&#39;</span><span class="p">:</span><span class="s">&#39;CDR3-IMGT_4&#39;</span><span class="p">,</span>		
		
		<span class="s">&#39;VREGION.FR1.NT&#39;</span><span class="p">:</span><span class="s">&#39;FR1-IMGT_3&#39;</span><span class="p">,</span>
		<span class="s">&#39;GAPPED.VREGION.FR1.NT&#39;</span><span class="p">:</span><span class="s">&#39;FR1-IMGT_2&#39;</span><span class="p">,</span>
		
		<span class="s">&#39;VREGION.FR1.AA&#39;</span><span class="p">:</span><span class="s">&#39;FR1-IMGT_5&#39;</span><span class="p">,</span>
		<span class="s">&#39;GAPPED.VREGION.FR1.AA&#39;</span><span class="p">:</span><span class="s">&#39;FR1-IMGT_4&#39;</span><span class="p">,</span>
		
		<span class="s">&#39;VREGION.FR2.NT&#39;</span><span class="p">:</span><span class="s">&#39;FR2-IMGT_3&#39;</span><span class="p">,</span>
		<span class="s">&#39;GAPPED.VREGION.FR2.NT&#39;</span><span class="p">:</span><span class="s">&#39;FR2-IMGT_2&#39;</span><span class="p">,</span>
		
		<span class="s">&#39;VREGION.FR2.AA&#39;</span><span class="p">:</span><span class="s">&#39;FR2-IMGT_5&#39;</span><span class="p">,</span>
		<span class="s">&#39;GAPPED.VREGION.FR2.AA&#39;</span><span class="p">:</span><span class="s">&#39;FR2-IMGT_4&#39;</span><span class="p">,</span>
				
		<span class="s">&#39;VREGION.FR3.NT&#39;</span><span class="p">:</span><span class="s">&#39;FR3-IMGT_3&#39;</span><span class="p">,</span>
		<span class="s">&#39;GAPPED.VREGION.FR3.NT&#39;</span><span class="p">:</span><span class="s">&#39;FR3-IMGT_2&#39;</span><span class="p">,</span>
		
		<span class="s">&#39;VREGION.FR3.AA&#39;</span><span class="p">:</span><span class="s">&#39;FR3-IMGT_5&#39;</span><span class="p">,</span>	
		<span class="s">&#39;GAPPED.VREGION.FR3.AA&#39;</span><span class="p">:</span><span class="s">&#39;FR3-IMGT_4&#39;</span><span class="p">,</span>
		
		<span class="s">&#39;JREGION.FR4.NT&#39;</span><span class="p">:</span><span class="s">&#39;FR4-IMGT_3&#39;</span><span class="p">,</span>		
		<span class="s">&#39;GAPPED.JREGION.FR4.NT&#39;</span><span class="p">:</span><span class="s">&#39;FR4-IMGT_2&#39;</span><span class="p">,</span>
		
		<span class="s">&#39;JREGION.FR4.AA&#39;</span><span class="p">:</span><span class="s">&#39;FR4-IMGT_5&#39;</span><span class="p">,</span>								
		<span class="s">&#39;GAPPED.JREGION.FR4.AA&#39;</span><span class="p">:</span><span class="s">&#39;FR4-IMGT_4&#39;</span><span class="p">,</span>								
		
		<span class="s">&#39;VREGION.VGENE_QUERY_START&#39;</span><span class="p">:</span><span class="s">&#39;V-REGION start_3&#39;</span><span class="p">,</span>
		<span class="s">&#39;VREGION.VGENE_QUERY_END&#39;</span><span class="p">:</span><span class="s">&#39;V-REGION end_3&#39;</span><span class="p">,</span>
		<span class="s">&#39;JREGION.JGENE_QUERY_START&#39;</span><span class="p">:</span><span class="s">&#39;J-REGION start_3&#39;</span><span class="p">,</span>
		<span class="s">&#39;JREGION.JGENE_QUERY_END&#39;</span><span class="p">:</span><span class="s">&#39;J-REGION end_3&#39;</span><span class="p">,</span>
		<span class="s">&#39;VREGION.VGENES&#39;</span><span class="p">:</span><span class="s">&#39;V-GENE and allele_1&#39;</span><span class="p">,</span>
		<span class="s">&#39;JREGION.JGENES&#39;</span><span class="p">:</span><span class="s">&#39;J-GENE and allele_1&#39;</span><span class="p">,</span>
		<span class="s">&#39;DREGION.DGENES&#39;</span><span class="p">:</span><span class="s">&#39;D-GENE and allele_1&#39;</span><span class="p">,</span>
		
		<span class="s">&#39;VREGION.SHM.NT&#39;</span><span class="p">:</span><span class="s">&#39;VREGION.SHM.NT&#39;</span><span class="p">,</span> <span class="c">#created in filereader class (uses the field from fithe file summary V_REGION IDENTITY)</span>
		<span class="s">&#39;VREGION.SHM.NT_PER&#39;</span><span class="p">:</span><span class="s">&#39;VREGION.SHM.NT_PER&#39;</span><span class="p">,</span> <span class="c">#created in filereader class </span>
		<span class="s">&#39;VREGION.SHM.AA&#39;</span><span class="p">:</span><span class="s">&#39;VREGION.SHM.AA&#39;</span><span class="p">,</span> <span class="c">#created in filereader class</span>
		<span class="s">&#39;VREGION.SHM.AA_PER&#39;</span><span class="p">:</span><span class="s">&#39;VREGION.SHM.AA_PER&#39;</span><span class="p">,</span> <span class="c">#created in filereader class</span>
		
		<span class="s">&#39;JREGION.SHM.NT&#39;</span><span class="p">:</span><span class="s">&#39;JREGION.SHM.NT&#39;</span><span class="p">,</span> <span class="c">#created in filereader class (uses the field from fithe file summary J_REGION IDENTITY)</span>
		<span class="s">&#39;JREGION.SHM.NT_PER&#39;</span><span class="p">:</span><span class="s">&#39;JREGION.SHM.NT_PER&#39;</span><span class="p">,</span> <span class="c">#created in filereader class </span>
		
		<span class="s">&quot;PREDICTED_AB_SEQ.NT&quot;</span><span class="p">:</span><span class="s">&quot;PREDICTED_AB_SEQ.NT&quot;</span><span class="p">,</span><span class="c">#created in filereader class</span>
		<span class="s">&quot;PREDICTED_AB_SEQ.AA&quot;</span><span class="p">:</span><span class="s">&quot;PREDICTED_AB_SEQ.AA&quot;</span><span class="c">#created in filereader class</span>
				
	<span class="p">}</span>
<span class="p">}</span>


<span class="c"># ++++++++++++++++++++++++++++++++</span>
<span class="c"># ++++Default Decorator values++++</span>
<span class="c"># ++++++++++++++++++++++++++++++++</span>
<span class="n">FASTAdecoratorinfo</span><span class="o">=</span><span class="p">{</span><span class="n">description_var</span><span class="p">:[</span><span class="s">&#39;header&#39;</span><span class="p">,</span><span class="s">&#39;sequence&#39;</span><span class="p">]}</span>
<span class="n">FASTQdecoratorinfo</span><span class="o">=</span><span class="p">{</span><span class="n">description_var</span><span class="p">:[</span><span class="s">&#39;header&#39;</span><span class="p">,</span><span class="s">&#39;sequence&#39;</span><span class="p">,</span><span class="s">&#39;phred&#39;</span><span class="p">]}</span>

<span class="c"># ++++++++++++++++++++++++++++++++++++</span>
<span class="c"># ++++for extract_header function ++++</span>
<span class="c"># ++++++++++++++++++++++++++++++++++++</span>
<span class="n">num_line_search</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c">#sometimes additional info such as sequence id is passed along in the sequence header</span>
<span class="c">#this fucntion will check if any immunogrep data is in sequence header and return it</span>
<div class="viewcode-block" id="GetAdditionalInfo"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.GetAdditionalInfo">[docs]</a><span class="k">def</span> <span class="nf">GetAdditionalInfo</span><span class="p">(</span><span class="n">header_line</span><span class="p">):</span>
	<span class="n">additional_info</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;document_header&#39;</span><span class="p">:</span><span class="n">header_line</span><span class="p">}</span>
	<span class="k">if</span> <span class="n">fasta_file_delimiter</span> <span class="ow">in</span> <span class="n">header_line</span><span class="p">:</span>
		<span class="n">tmp</span><span class="o">=</span><span class="n">header_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fasta_file_delimiter</span><span class="p">)</span> <span class="c">#if extra info is included in the header, then it is passed using the the fasta_file_delimiter</span>
		<span class="n">header</span><span class="o">=</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>									
		<span class="k">try</span><span class="p">:</span>
			<span class="n">additional_info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">additional_info</span><span class="o">.</span><span class="n">items</span><span class="p">()</span><span class="o">+</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="c">#occurs if json string in sequence header was truncated</span>
			<span class="k">pass</span>		
	<span class="k">else</span><span class="p">:</span>
		<span class="n">header</span><span class="o">=</span><span class="n">header_line</span>		
	
	<span class="k">return</span> <span class="p">[</span><span class="n">header</span><span class="p">,</span><span class="n">additional_info</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="find_imgt_file_type_index"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.find_imgt_file_type_index">[docs]</a><span class="k">def</span> <span class="nf">find_imgt_file_type_index</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">important_headers_only</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
		<span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
		<span class="n">imgt_file_type</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)</span>
		<span class="n">imgt_file_type</span> <span class="o">=</span> <span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">imgt_file_type</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>	
		<span class="n">imgt_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">imgt_files_info</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">imgt_file_type</span><span class="p">]</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">imgt_file</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">[</span><span class="n">imgt_file</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">imgt_files_info</span><span class="p">[</span><span class="n">imgt_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;Important_Headers&#39;</span><span class="p">]]</span> <span class="k">if</span> <span class="n">important_headers_only</span> <span class="k">else</span> <span class="p">[</span><span class="n">imgt_file</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">imgt_files_info</span><span class="p">[</span><span class="n">imgt_file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;Headers&#39;</span><span class="p">]]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
	

<span class="c">#WE ASSUME IMGT FILES ARE LABELED USING IMGT RULES:</span>
<span class="c">#=&gt;FILENUMBER_IMGTFILENAME_USERFILENAME.txt</span></div>
<div class="viewcode-block" id="GroupIMGTFiles"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.GroupIMGTFiles">[docs]</a><span class="k">def</span> <span class="nf">GroupIMGTFiles</span><span class="p">(</span><span class="n">imgt_files</span><span class="p">):</span>
	<span class="c">#imgt_files = sorted([str(im_f) for im_f in imgt_files],key=str.lower)	</span>
	<span class="n">grouped_files</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">each_file</span> <span class="ow">in</span> <span class="n">imgt_files</span><span class="p">:</span>
		<span class="n">filenum</span><span class="o">=</span><span class="n">find_imgt_file_type_index</span><span class="p">(</span><span class="n">each_file</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">each_file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.txt&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenum</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">filenum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>			
			<span class="c">#take basename of file , split by &#39;_&#39;</span>
			<span class="n">split_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">each_file</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)</span>
			<span class="c">#only consider the filename after 1_imgtfilename_submittedfilename.txt</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_file</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">2</span><span class="p">:</span>
				<span class="n">submitted_filename</span> <span class="o">=</span> <span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">split_file</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">submitted_filename</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
			<span class="n">grouped_files</span><span class="p">[</span><span class="n">submitted_filename</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">each_file</span><span class="p">)</span>	
	<span class="c">#grouped_files = {group:files for group,files in grouped_files.iteritems() if files}</span>
	
	<span class="k">return</span> <span class="n">grouped_files</span>



<span class="c">#++++++++++++++++++++++++++++++++++++</span>
<span class="c">#Simple function for reading a block of</span>
<span class="c">#data from an igblast file output##</span>
<span class="c">#++++++++++++++++++</span></div>
<div class="viewcode-block" id="ReadIgBlastQueryBlock"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.ReadIgBlastQueryBlock">[docs]</a><span class="k">def</span> <span class="nf">ReadIgBlastQueryBlock</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">igblast_eof</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>

	<span class="n">igblast_query_block</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
	<span class="n">igblast_query_seq_header</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
	<span class="n">igblast_read_line</span> <span class="o">=</span> <span class="bp">True</span>
	
	<span class="k">while</span> <span class="p">(</span><span class="n">igblast_read_line</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">igblast_eof</span><span class="p">)):</span> 
		<span class="n">line_info</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>		
		
		<span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">line_info</span><span class="p">):</span>
			<span class="n">igblast_eof</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="k">break</span>
		
		<span class="k">if</span> <span class="n">line_info</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span> <span class="c">#skip empty lines </span>
			<span class="k">continue</span>
					
		<span class="c"># IGBLASTN</span>
		<span class="k">if</span> <span class="n">line_info</span><span class="p">[:</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">==</span> <span class="s">&quot;# IGBLAST&quot;</span><span class="p">:</span> <span class="c">#start of a new query </span>
			<span class="n">igblast_read_line</span> <span class="o">=</span> <span class="bp">False</span>
			<span class="k">break</span>
		<span class="k">elif</span> <span class="n">line_info</span><span class="p">[:</span><span class="mi">17</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span><span class="s">&quot;# BLAST PROCESSED&quot;</span><span class="p">:</span> <span class="c">#at the complete end of the igblast files				</span>
			<span class="n">igblast_eof</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="k">break</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">igblast_query_block</span> <span class="o">+=</span> <span class="n">line_info</span>
			
		
		<span class="k">if</span> <span class="n">line_info</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;# QUERY:&quot;</span><span class="p">:</span>
			<span class="n">igblast_query_seq_header</span> <span class="o">=</span> <span class="n">line_info</span><span class="p">[</span><span class="mi">9</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>				
			
	<span class="c">####NOW WE SHOULD HAVE READ IN AN ENTIRE BLOCK FOR THE CURRENT IGBLAST query</span>
	<span class="k">return</span> <span class="p">[</span><span class="n">igblast_query_block</span><span class="p">,</span><span class="n">igblast_query_seq_header</span><span class="p">]</span>



<span class="c"># +++++++++++++++++++++++</span>
<span class="c"># +immunogrepFile Class +</span>
<span class="c"># +++++++++++++++++++++++ </span></div>
<div class="viewcode-block" id="immunogrepFile"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile">[docs]</a><span class="k">class</span> <span class="nc">immunogrepFile</span><span class="p">():</span>
	<span class="c">#the following parameters are ONLY used for IMGT : important_headers_only =True,include_parameters_file=False,required_files=0</span>
	<span class="c">#the following parameters are ONLY used for DELIM files/TAB/CSV: delimiter=None, contains_header=True</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filelocation</span><span class="p">,</span><span class="n">filetype</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">contains_header</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">field_names</span><span class="o">=</span><span class="p">[],</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">important_headers_only</span> <span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">include_parameters_file</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">required_files</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
		 
		<span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">=</span><span class="n">filelocation</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="n">decoratorinfo</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">contains_header</span><span class="o">=</span><span class="n">contains_header</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="o">=</span><span class="n">field_names</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span>
		
		<span class="k">if</span> <span class="n">filetype</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">filetype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">current_filetypes</span><span class="p">[</span><span class="s">&#39;FASTA&#39;</span><span class="p">]:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;FASTA&#39;</span>
			<span class="k">elif</span> <span class="n">filetype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">current_filetypes</span><span class="p">[</span><span class="s">&#39;TAB&#39;</span><span class="p">]:</span>			
				<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;TAB&#39;</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>
			<span class="k">elif</span> <span class="n">filetype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">current_filetypes</span><span class="p">[</span><span class="s">&#39;CSV&#39;</span><span class="p">]:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;CSV&#39;</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="o">=</span><span class="s">&#39;,&#39;</span>
			<span class="k">elif</span> <span class="n">filetype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">current_filetypes</span><span class="p">[</span><span class="s">&#39;FASTQ&#39;</span><span class="p">]:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;FASTQ&#39;</span>
			<span class="k">elif</span> <span class="n">filetype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">current_filetypes</span><span class="p">[</span><span class="s">&#39;JSON&#39;</span><span class="p">]:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;JSON&#39;</span>
			<span class="k">elif</span> <span class="n">filetype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">current_filetypes</span><span class="p">[</span><span class="s">&#39;DELIM&#39;</span><span class="p">]:</span>
				<span class="k">if</span> <span class="n">delimiter</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;DELIM&#39;</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s">&quot; &#39;delim&#39; filetype requires user-defined delimiter !&quot;</span><span class="p">)</span>
			<span class="k">elif</span> <span class="n">filetype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">current_filetypes</span><span class="p">[</span><span class="s">&#39;IMGT&#39;</span><span class="p">]:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;IMGT&#39;</span>
			<span class="c">#else:</span>
			<span class="c">#	raise Exception(&#39;The following filetype, {0}, is invalid&#39;.format(filetype))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">guessFiletype</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>			
			<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">guessFiletype</span><span class="p">()</span>
	
		<span class="c"># Checking file exisitence, if not, it will be createdf</span>
		<span class="c">#IMGT FILES MUST BE LIST OF FILES, ALL OTHER FILES MUST BE BASESTRING</span>
		<span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;r&#39;</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">filetype</span><span class="o">==</span><span class="s">&#39;IMGT&#39;</span><span class="p">:</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">]</span>
					<span class="k">for</span> <span class="n">each_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">:</span>
						<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">each_file</span><span class="p">):</span>
							<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;The File {0} does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">each_file</span><span class="p">))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="nb">basestring</span><span class="p">):</span>
					<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Only immunogrep files whose filetypes are defined as &quot;IMGT&quot; may be passed in as a list of files. all other file types must be strings&#39;</span><span class="p">)</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">):</span>							
					<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;The file {0} does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">))</span>
					<span class="c">#sys.exit(&quot;The file does not exist&quot;)</span>
			

		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">filetypedict</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;IMGT&#39;</span><span class="p">:</span><span class="n">immunogrepIMGT</span><span class="p">,</span><span class="s">&#39;FASTA&#39;</span><span class="p">:</span><span class="n">immunogrepFASTA</span><span class="p">,</span><span class="s">&#39;FASTQ&#39;</span><span class="p">:</span><span class="n">immunogrepFASTQ</span><span class="p">,</span><span class="s">&#39;TAB&#39;</span><span class="p">:</span><span class="n">immunogrepDELIM</span><span class="p">,</span><span class="s">&#39;CSV&#39;</span><span class="p">:</span><span class="n">immunogrepDELIM</span><span class="p">,</span><span class="s">&#39;JSON&#39;</span><span class="p">:</span><span class="n">immunogrepJSON</span><span class="p">,</span><span class="s">&#39;DELIM&#39;</span><span class="p">:</span><span class="n">immunogrepDELIM</span><span class="p">}</span>						
			
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span> <span class="o">==</span> <span class="s">&#39;DELIM&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">==</span><span class="s">&#39;CSV&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">==</span><span class="s">&#39;TAB&#39;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">IFclass</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filetypedict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="p">](</span><span class="n">filelocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="n">filetype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="p">,</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="p">,</span><span class="n">contains_header</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">contains_header</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span><span class="n">field_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="p">,</span><span class="n">chunk_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">)</span>			
			<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">==</span><span class="s">&#39;IMGT&#39;</span><span class="p">:</span>			
				<span class="bp">self</span><span class="o">.</span><span class="n">IFclass</span><span class="o">=</span><span class="n">immunogrepIMGT</span><span class="p">(</span><span class="n">imgtfiles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="n">field_names</span> <span class="o">=</span> <span class="n">field_names</span><span class="p">,</span> <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">chunk_size</span><span class="p">,</span><span class="n">important_headers_only</span><span class="o">=</span><span class="n">important_headers_only</span><span class="p">,</span><span class="n">include_parameters_file</span><span class="o">=</span><span class="n">include_parameters_file</span><span class="p">,</span><span class="n">required_files</span><span class="o">=</span><span class="n">required_files</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">IFclass</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filetypedict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="p">](</span><span class="n">filelocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="n">filetype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="p">,</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span><span class="n">field_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="p">,</span><span class="n">chunk_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>			
			<span class="bp">self</span><span class="o">.</span><span class="n">IFclass</span><span class="o">=</span><span class="bp">None</span>			
		
<div class="viewcode-block" id="immunogrepFile.getFilelocation"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.getFilelocation">[docs]</a>	<span class="k">def</span> <span class="nf">getFilelocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span>
</div>
<div class="viewcode-block" id="immunogrepFile.getFiletype"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.getFiletype">[docs]</a>	<span class="k">def</span> <span class="nf">getFiletype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span>
</div>
<div class="viewcode-block" id="immunogrepFile.guessFiletype"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.guessFiletype">[docs]</a>	<span class="k">def</span> <span class="nf">guessFiletype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">check</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">fileformat</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;FASTA&#39;</span><span class="p">,</span><span class="s">&#39;FASTQ&#39;</span><span class="p">,</span><span class="s">&#39;JSON&#39;</span><span class="p">,</span><span class="s">&#39;TAB&#39;</span><span class="p">,</span><span class="s">&#39;CSV&#39;</span><span class="p">]</span>
	
		<span class="n">check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isFASTA</span><span class="p">())</span>
	
		<span class="n">check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isFASTQ</span><span class="p">())</span>
	
		<span class="n">check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isJSON</span><span class="p">())</span>

		<span class="n">check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isTAB</span><span class="p">())</span>

		<span class="n">check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isCSV</span><span class="p">())</span>
		
		<span class="n">checkcnt</span><span class="o">=</span><span class="n">check</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
		
		<span class="k">if</span> <span class="n">check</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>			
			<span class="c">#if JSON is listed as true, then irespect to other checks and report as JSON </span>
			<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="n">fileformat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>			
		<span class="k">elif</span> <span class="n">checkcnt</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="n">fileformat</span><span class="p">[</span><span class="n">check</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">True</span><span class="p">)]</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">==</span><span class="s">&#39;TAB&#39;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="o">=</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">==</span><span class="s">&#39;CSV&#39;</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="o">=</span><span class="s">&quot;,&quot;</span>					
		<span class="k">else</span><span class="p">:</span>			
			<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="bp">None</span>
		
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span>
</div>
<div class="viewcode-block" id="immunogrepFile.getDecoratorinfo"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.getDecoratorinfo">[docs]</a>	<span class="k">def</span> <span class="nf">getDecoratorinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isimmunogrepFile</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">line</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
				<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="p">):]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span><span class="s">&#39;&quot;&#39;</span><span class="p">))</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="p">{}</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span>
</div>
<div class="viewcode-block" id="immunogrepFile.getDescription"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.getDescription">[docs]</a>	<span class="k">def</span> <span class="nf">getDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IFclass</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">()</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">()[</span><span class="n">description_var</span><span class="p">]:</span>
					<span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">()[</span><span class="n">description_var</span><span class="p">]</span>
				<span class="k">else</span><span class="p">:</span>				
					<span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">IFclass</span><span class="o">.</span><span class="n">Extract_Header</span><span class="p">()</span> 		
			<span class="k">else</span><span class="p">:</span>			
				<span class="n">d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">IFclass</span><span class="o">.</span><span class="n">Extract_Header</span><span class="p">()</span>
			<span class="k">return</span> <span class="n">d</span>
		<span class="k">else</span><span class="p">:</span>		
			<span class="k">return</span> <span class="bp">None</span>
		</div>
<div class="viewcode-block" id="immunogrepFile.getTranslation"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.getTranslation">[docs]</a>	<span class="k">def</span> <span class="nf">getTranslation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">()</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">()[</span><span class="n">translation_var</span><span class="p">]:</span>
				<span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">()[</span><span class="n">translation_var</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">t</span><span class="o">=</span><span class="bp">None</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">t</span><span class="o">=</span><span class="bp">None</span>
		<span class="k">return</span> <span class="n">t</span>

	<span class="c"># Note: create method will create/overwrite file specificed in filelocation and add decorator to the first line</span>
	<span class="c"># This function is a residual function; might be obsolete</span></div>
<div class="viewcode-block" id="immunogrepFile.create"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.create">[docs]</a>	<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">IFExt</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
			<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">IFExt</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;JSON&#39;</span>
</div>
<div class="viewcode-block" id="immunogrepFile.isimmunogrepFile"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.isimmunogrepFile">[docs]</a>	<span class="k">def</span> <span class="nf">isimmunogrepFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">check</span><span class="o">=</span><span class="bp">False</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
			<span class="n">line</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="p">):]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span><span class="s">&#39;&quot;&#39;</span><span class="p">))</span>
					<span class="n">check</span><span class="o">=</span><span class="bp">True</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="n">check</span><span class="o">=</span><span class="bp">False</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">check</span><span class="o">=</span><span class="bp">False</span>
			<span class="n">line</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span><span class="s">&#39;&quot;&#39;</span><span class="p">))</span>
				<span class="n">check</span><span class="o">=</span><span class="bp">True</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="n">check</span><span class="o">=</span><span class="bp">False</span>
		<span class="k">return</span> <span class="n">check</span> <span class="ow">and</span> <span class="n">IFExt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span>
</div>
<div class="viewcode-block" id="immunogrepFile.isFASTA"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.isFASTA">[docs]</a>	<span class="k">def</span> <span class="nf">isFASTA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">check</span><span class="o">=</span><span class="bp">False</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">preview_lines</span> <span class="o">=</span> <span class="mi">100</span>
			<span class="n">temp_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;__temp__&#39;</span>
			<span class="n">bash_command</span> <span class="o">=</span> <span class="s">&#39;head -{0} &quot;{1}&quot; &gt; &quot;{2}&quot; &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">preview_lines</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="n">temp_file</span><span class="p">)</span>
			<span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">bash_command</span><span class="p">,</span><span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
			<span class="c">#os.system(bash_command)</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_file</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>			
				<span class="n">line</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
				
				<span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="p">):</span>
					<span class="n">line</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>				
				<span class="k">else</span><span class="p">:</span>				
					<span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>			
					
				<span class="n">g</span><span class="o">=</span><span class="n">SeqIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="s">&quot;fasta&quot;</span><span class="p">)</span>
									
				<span class="k">try</span><span class="p">:</span>
					<span class="n">g</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
					<span class="n">check</span><span class="o">=</span><span class="bp">True</span>
				<span class="k">except</span><span class="p">:</span>	
					<span class="n">check</span><span class="o">=</span><span class="bp">False</span>
			<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">temp_file</span><span class="p">)</span><span class="c">#os.system(&#39;rm &quot;{0}&quot;&#39;.format(temp_file))</span>
			<span class="k">return</span> <span class="n">check</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">False</span>
		</div>
<div class="viewcode-block" id="immunogrepFile.isFASTQ"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.isFASTQ">[docs]</a>	<span class="k">def</span> <span class="nf">isFASTQ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">check</span><span class="o">=</span><span class="bp">False</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">preview_lines</span> <span class="o">=</span> <span class="mi">100</span>
			<span class="n">temp_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;__temp__&#39;</span>
			<span class="n">bash_command</span> <span class="o">=</span> <span class="s">&#39;head -{0} &quot;{1}&quot; &gt; &quot;{2}&quot; &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">preview_lines</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="n">temp_file</span><span class="p">)</span>
			<span class="c">#os.system(bash_command)</span>
			<span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">bash_command</span><span class="p">,</span><span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_file</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">line</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
				<span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="p">):</span>
					<span class="n">line</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
				<span class="n">g</span><span class="o">=</span><span class="n">SeqIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="s">&quot;fastq&quot;</span><span class="p">)</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">g</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
					<span class="n">check</span><span class="o">=</span><span class="bp">True</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="n">check</span><span class="o">=</span><span class="bp">False</span>
			<span class="c">#os.system(&#39;rm &quot;{0}&quot;&#39;.format(temp_file))</span>
			<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">temp_file</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">check</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">False</span>

	<span class="c"># Note: Must be a block delimited file format; jaggered delimited file format is considered invalid</span></div>
<div class="viewcode-block" id="immunogrepFile.isDelim"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.isDelim">[docs]</a>	<span class="k">def</span> <span class="nf">isDelim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">delimiter</span><span class="p">):</span>
		<span class="n">check</span><span class="o">=</span><span class="bp">False</span>
		<span class="n">chkcnt</span><span class="o">=</span><span class="p">[]</span>
		
		<span class="k">try</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">line</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
					<span class="n">line</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_line_search</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">line</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">:</span>						
						<span class="k">break</span>									
					<span class="n">chkcnt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">delimiter</span><span class="p">))</span>
					<span class="n">line</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
	
			<span class="n">unique_chckcnt</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">chkcnt</span><span class="p">)</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_chckcnt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">list</span><span class="p">(</span><span class="n">unique_chckcnt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
				<span class="n">check</span><span class="o">=</span><span class="bp">True</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">check</span><span class="o">=</span><span class="bp">False</span>		
			<span class="k">return</span> <span class="n">check</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="immunogrepFile.isTAB"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.isTAB">[docs]</a>	<span class="k">def</span> <span class="nf">isTAB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">check</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">isDelim</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">check</span>
	</div>
<div class="viewcode-block" id="immunogrepFile.isCSV"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.isCSV">[docs]</a>	<span class="k">def</span> <span class="nf">isCSV</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">check</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">isDelim</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">check</span>
</div>
<div class="viewcode-block" id="immunogrepFile.isJSON"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.isJSON">[docs]</a>	<span class="k">def</span> <span class="nf">isJSON</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">check</span><span class="o">=</span><span class="bp">True</span>
		<span class="n">chkcnt</span><span class="o">=</span><span class="mi">0</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">line</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
				<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
					<span class="n">line</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_line_search</span><span class="p">):</span>
					<span class="n">line</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
					<span class="k">if</span> <span class="n">line</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">:</span>
						<span class="k">break</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="n">check</span><span class="o">=</span><span class="bp">False</span>				
			<span class="k">return</span> <span class="n">check</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="immunogrepFile.convert2FASTA"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.convert2FASTA">[docs]</a>	<span class="k">def</span> <span class="nf">convert2FASTA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">headervar</span><span class="p">,</span><span class="n">sequencevar</span><span class="p">,</span><span class="n">keepinfo</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">==</span><span class="s">&#39;JSON&#39;</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.fna&#39;</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
						<span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
						<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
							<span class="n">body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
							<span class="n">addbody</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
							<span class="k">if</span> <span class="n">keepinfo</span><span class="p">:</span>
								<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">body</span><span class="p">:</span>
									<span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">headervar</span><span class="p">,</span><span class="n">sequencevar</span><span class="p">]:</span>
										<span class="n">addbody</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">body</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
								<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&gt;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">headervar</span><span class="p">]</span><span class="o">+</span><span class="n">fasta_file_delimiter</span><span class="o">+</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">addbody</span><span class="p">),</span><span class="n">body</span><span class="p">[</span><span class="n">sequencevar</span><span class="p">]))</span>
							<span class="k">else</span><span class="p">:</span>
								<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&gt;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">headervar</span><span class="p">],</span><span class="n">body</span><span class="p">[</span><span class="n">sequencevar</span><span class="p">]))</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.fna&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;FASTA&#39;</span>
</div>
<div class="viewcode-block" id="immunogrepFile.convert2FASTQ"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.convert2FASTQ">[docs]</a>	<span class="k">def</span> <span class="nf">convert2FASTQ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">headervar</span><span class="p">,</span><span class="n">sequencevar</span><span class="p">,</span><span class="n">qualvar</span><span class="p">,</span><span class="n">keepinfo</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">==</span><span class="s">&#39;JSON&#39;</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.fastq&#39;</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
						<span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
						<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
							<span class="n">body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
							<span class="n">addbody</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
							<span class="k">if</span> <span class="n">keepinfo</span><span class="p">:</span>
								<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">body</span><span class="p">:</span>
									<span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">headervar</span><span class="p">,</span><span class="n">sequencevar</span><span class="p">,</span><span class="n">qualvar</span><span class="p">]:</span>
										<span class="n">addbody</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">body</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
								<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;@</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">+</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">headervar</span><span class="p">]</span><span class="o">+</span><span class="n">fasta_file_delimiter</span><span class="o">+</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">addbody</span><span class="p">),</span><span class="n">body</span><span class="p">[</span><span class="n">sequencevar</span><span class="p">],</span><span class="n">body</span><span class="p">[</span><span class="n">qualvar</span><span class="p">]))</span>
							<span class="k">else</span><span class="p">:</span>
								<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;@</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">+</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">headervar</span><span class="p">],</span><span class="n">body</span><span class="p">[</span><span class="n">sequencevar</span><span class="p">],</span><span class="n">body</span><span class="p">[</span><span class="n">qualvar</span><span class="p">]))</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.fastq&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;FASTQ&#39;</span>
</div>
<div class="viewcode-block" id="immunogrepFile.convert2Delim"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.convert2Delim">[docs]</a>	<span class="k">def</span> <span class="nf">convert2Delim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">descriptionlist</span><span class="p">,</span><span class="n">delimiter</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">==</span><span class="s">&#39;JSON&#39;</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.txt&#39;</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">descriptionlist</span><span class="p">:</span>
						<span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">fout</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span>
					<span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">fout</span><span class="p">,</span><span class="s">&quot;&quot;</span>
					<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
						<span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
						<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
							<span class="n">body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
							<span class="n">bodytxt</span><span class="o">=</span><span class="bp">None</span>
							<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">descriptionlist</span><span class="p">:</span>
								<span class="k">if</span> <span class="n">body</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
									<span class="n">body</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;N/A&#39;</span>
								<span class="k">if</span> <span class="ow">not</span> <span class="n">bodytxt</span><span class="p">:</span>
									<span class="n">bodytxt</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="n">bodytxt</span><span class="o">=</span><span class="n">bodytxt</span><span class="o">+</span><span class="n">delimiter</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
							<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="n">bodytxt</span><span class="p">)</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
							<span class="n">label</span><span class="o">=</span><span class="bp">None</span>
							<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">descriptionlist</span><span class="p">:</span>
								<span class="k">if</span> <span class="ow">not</span> <span class="n">label</span><span class="p">:</span>
									<span class="n">label</span><span class="o">=</span><span class="n">i</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="o">+</span><span class="n">delimiter</span><span class="o">+</span><span class="n">i</span>
							<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="n">label</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.txt&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;DELIM&#39;</span>	
</div>
<div class="viewcode-block" id="immunogrepFile.convert2TAB"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.convert2TAB">[docs]</a>	<span class="k">def</span> <span class="nf">convert2TAB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">descriptionlist</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">==</span><span class="s">&#39;JSON&#39;</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.txt&#39;</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">descriptionlist</span><span class="p">:</span>
						<span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">fout</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span>
					<span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">fout</span><span class="p">,</span><span class="s">&quot;&quot;</span>
					<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
						<span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
						<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
							<span class="n">body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
							<span class="n">bodytxt</span><span class="o">=</span><span class="bp">None</span>
							<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">descriptionlist</span><span class="p">:</span>
								<span class="k">if</span> <span class="n">body</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
									<span class="n">body</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;N/A&#39;</span>
								<span class="k">if</span> <span class="ow">not</span> <span class="n">bodytxt</span><span class="p">:</span>
									<span class="n">bodytxt</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="n">bodytxt</span><span class="o">=</span><span class="n">bodytxt</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
							<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="n">bodytxt</span><span class="p">)</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
							<span class="n">label</span><span class="o">=</span><span class="bp">None</span>
							<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">descriptionlist</span><span class="p">:</span>
								<span class="k">if</span> <span class="ow">not</span> <span class="n">label</span><span class="p">:</span>
									<span class="n">label</span><span class="o">=</span><span class="n">i</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">+</span><span class="n">i</span>
							<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="n">label</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.txt&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;TAB&#39;</span>
		</div>
<div class="viewcode-block" id="immunogrepFile.convert2CSV"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.convert2CSV">[docs]</a>	<span class="k">def</span> <span class="nf">convert2CSV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">descriptionlist</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">==</span><span class="s">&#39;JSON&#39;</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.csv&#39;</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">descriptionlist</span><span class="p">:</span>
						<span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">fout</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">%</span><span class="n">i</span><span class="p">,</span>
					<span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">fout</span><span class="p">,</span><span class="s">&quot;&quot;</span>
					<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
						<span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
						<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
							<span class="n">body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
							<span class="n">bodytxt</span><span class="o">=</span><span class="bp">None</span>
							<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">descriptionlist</span><span class="p">:</span>
								<span class="k">if</span> <span class="n">body</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
									<span class="n">body</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;N/A&#39;</span>
								<span class="k">if</span> <span class="ow">not</span> <span class="n">bodytxt</span><span class="p">:</span>
									<span class="n">bodytxt</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="n">bodytxt</span><span class="o">=</span><span class="n">bodytxt</span><span class="o">+</span><span class="s">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
							<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="n">bodytxt</span><span class="p">)</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
							<span class="n">label</span><span class="o">=</span><span class="bp">None</span>
							<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">descriptionlist</span><span class="p">:</span>
								<span class="k">if</span> <span class="ow">not</span> <span class="n">label</span><span class="p">:</span>
									<span class="n">label</span><span class="o">=</span><span class="n">i</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="o">+</span><span class="s">&quot;,&quot;</span><span class="o">+</span><span class="n">i</span>
							<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="n">label</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.csv&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;CSV&#39;</span>

	<span class="c">#generator constructor for simple file reading</span>
	<span class="c">#dummy_var=&gt;I had to call immunogrepfile.read() in a function , but that function assumed there had to be a parameter passed into read function. So I set a dummy_var that never gets Used</span></div>
<div class="viewcode-block" id="immunogrepFile.read"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFile.read">[docs]</a>	<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dummy_var</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IFclass</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">return</span>
		<span class="k">while</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IFclass</span><span class="o">.</span><span class="n">eof</span><span class="p">):</span>		
			<span class="n">line_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IFclass</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>				
			<span class="k">if</span> <span class="n">line_data</span><span class="p">:</span>
				<span class="k">yield</span> <span class="n">line_data</span>
</div>
	<span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="s">&quot;Please refer to http://bigg.icmb.utexas.edu:5000/immunogrepFile/ for Manual.&quot;</span>

</div>
<div class="viewcode-block" id="immunogrepFASTA"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTA">[docs]</a><span class="k">class</span> <span class="nc">immunogrepFASTA</span><span class="p">():</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filelocation</span><span class="p">,</span><span class="n">filetype</span><span class="p">,</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="n">FASTAdecoratorinfo</span><span class="p">,</span><span class="n">contains_header</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">field_names</span><span class="o">=</span><span class="p">[],</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">=</span><span class="n">filelocation</span>
		<span class="n">fasta_file_comment</span> <span class="o">=</span> <span class="s">&quot;#&quot;</span> <span class="c">#standard comment for all fastafiles</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="n">filetype</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="o">=</span><span class="n">field_names</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">contains_header</span> <span class="o">=</span> <span class="bp">False</span>
		<span class="k">if</span> <span class="n">decoratorinfo</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">tmpline</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
				<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="n">tmpline</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tmpline</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="p">):]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span><span class="s">&#39;&quot;&#39;</span><span class="p">))</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="p">{}</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="n">FASTAdecoratorinfo</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="n">decoratorinfo</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">SeqIOfilehandle</span><span class="o">=</span><span class="n">SeqIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="p">,</span><span class="s">&#39;fasta&#39;</span><span class="p">)</span>
		<span class="c">#By-passing the decorator line if it exists</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">temphandle</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">temphandle</span><span class="o">.</span><span class="n">readline</span><span class="p">():</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">SeqIOfilehandle</span><span class="o">=</span><span class="n">SeqIO</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temphandle</span><span class="p">,</span><span class="s">&#39;fasta&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">eof</span><span class="o">=</span><span class="bp">False</span>
		
	
<div class="viewcode-block" id="immunogrepFASTA.Extract_Header"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTA.Extract_Header">[docs]</a>	<span class="k">def</span> <span class="nf">Extract_Header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		
		<span class="n">linenum</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">readunit</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
		<span class="n">endchk</span><span class="o">=</span><span class="bp">False</span>
		<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
		
		<span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>		
		<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
			<span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_header</span><span class="p">:</span>
				<span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
		
		<span class="n">numSeq</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">totallines</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">fail</span> <span class="o">=</span> <span class="bp">False</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">while</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">numSeq</span><span class="o">&lt;</span><span class="n">num_line_search</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">fail</span><span class="p">):</span>
				
				<span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>			
				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">1</span> <span class="ow">and</span> <span class="s">&#39;&gt;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>					
					<span class="p">[</span><span class="n">header</span><span class="p">,</span><span class="n">more_fields</span><span class="p">]</span> <span class="o">=</span> <span class="n">GetAdditionalInfo</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>					
					<span class="n">fields</span><span class="o">+=</span><span class="n">more_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
					
					<span class="c">#if fasta_file_delimiter in line:</span>
					<span class="c">#	tmp=line.split(fasta_file_delimiter) #if extra info is included in the header, then it is passed using the the fasta_file_delimiter													</span>
					<span class="c">#	additional_info = json.loads(tmp[1])						</span>
					<span class="c">#	fields = fields+additional_info.keys()</span>
					<span class="n">numSeq</span><span class="o">+=</span><span class="mi">1</span>
				<span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
				<span class="n">totallines</span><span class="o">+=</span><span class="mi">1</span>
				<span class="k">if</span> <span class="n">totallines</span> <span class="o">==</span> <span class="n">num_line_search</span><span class="o">*</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">numSeq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
					<span class="n">fail</span> <span class="o">=</span> <span class="bp">True</span>				
			<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		
			<span class="c">#unique_fields = sorted(set(fields))</span>
			<span class="n">fields</span> <span class="o">=</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">,</span><span class="s">&#39;sequence&#39;</span><span class="p">,</span><span class="s">&#39;document_header&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">))</span>
			<span class="n">fields</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">))</span>
		
			<span class="k">if</span> <span class="n">fail</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">None</span>
			<span class="k">else</span><span class="p">:</span>				
				<span class="k">return</span> <span class="n">fields</span>
		<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">print</span> <span class="n">e</span>
			<span class="k">return</span> <span class="bp">None</span>
	</div>
<div class="viewcode-block" id="immunogrepFASTA.convert2IF"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTA.convert2IF">[docs]</a>	<span class="k">def</span> <span class="nf">convert2IF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">==</span><span class="s">&#39;FASTA&#39;</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">IFExt</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
				<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="o">+</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
				<span class="n">decor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span>
				<span class="n">body</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
				<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">decor</span><span class="p">[</span><span class="n">description_var</span><span class="p">]:</span>
					<span class="n">body</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;&#39;</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
						<span class="k">if</span> <span class="s">&#39;&gt;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
							<span class="k">if</span> <span class="n">body</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">body</span><span class="p">[</span><span class="s">&#39;sequence&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s">&#39;&#39;</span><span class="p">:</span>
								<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
							<span class="k">if</span> <span class="n">fasta_file_delimiter</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
								<span class="n">tmp</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fasta_file_delimiter</span><span class="p">)</span>
								<span class="n">addbody</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
								<span class="k">if</span> <span class="n">idIdentifier</span> <span class="ow">in</span> <span class="n">addbody</span><span class="p">:</span>
									<span class="n">addbody</span><span class="p">[</span><span class="n">idIdentifier</span><span class="p">]</span><span class="o">=</span><span class="n">addbody</span><span class="p">[</span><span class="n">idIdentifier</span><span class="p">]</span>
								<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">addbody</span><span class="p">:</span>
									<span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">[</span><span class="n">description_var</span><span class="p">]:</span>
										<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">[</span><span class="n">description_var</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
									<span class="n">body</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">addbody</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
								<span class="n">body</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
							<span class="k">else</span><span class="p">:</span>
								<span class="n">body</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
							<span class="n">body</span><span class="p">[</span><span class="s">&#39;sequence&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;&#39;</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">body</span><span class="p">[</span><span class="s">&#39;sequence&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">body</span><span class="p">[</span><span class="s">&#39;sequence&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
					<span class="k">if</span> <span class="n">body</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">body</span><span class="p">[</span><span class="s">&#39;sequence&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s">&#39;&#39;</span><span class="p">:</span>
						<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">IFExt</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;JSON&#39;</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">[</span><span class="n">description_var</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
				<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;sed -i &#39;1 c\</span><span class="si">%s</span><span class="s">&#39; </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="o">+</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="immunogrepFASTA.read"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTA.read">[docs]</a>	<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">readunit</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
		
		<span class="k">try</span><span class="p">:</span>
			<span class="n">line</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SeqIOfilehandle</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">eof</span><span class="o">=</span><span class="bp">True</span>
			<span class="n">readunit</span><span class="o">=</span><span class="bp">None</span>
			
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">eof</span><span class="p">:</span>						
			<span class="n">readunit</span><span class="p">[</span><span class="s">&#39;sequence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span>
			<span class="n">header_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">description</span>
			<span class="n">readunit</span><span class="p">[</span><span class="s">&#39;document_header&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">header_line</span>
			<span class="k">if</span> <span class="n">fasta_file_delimiter</span> <span class="ow">in</span> <span class="n">header_line</span><span class="p">:</span>
				<span class="n">tmp</span><span class="o">=</span><span class="n">header_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fasta_file_delimiter</span><span class="p">)</span> <span class="c">#if extra info is included in the header, then it is passed using the the fasta_file_delimiter</span>
				<span class="n">readunit</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>									
				<span class="n">additional_info</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>						
		
				<span class="k">for</span> <span class="n">keyval</span> <span class="ow">in</span> <span class="n">additional_info</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">keyval</span> <span class="o">==</span> <span class="n">idIdentifier</span><span class="p">:</span>
						<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">additional_info</span><span class="p">[</span><span class="n">keyval</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>							
							<span class="n">readunit</span><span class="p">[</span><span class="n">idIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">additional_info</span><span class="p">[</span><span class="n">keyval</span><span class="p">][</span><span class="s">&#39;$oid&#39;</span><span class="p">]</span>
						<span class="k">else</span><span class="p">:</span>							
							<span class="n">readunit</span><span class="p">[</span><span class="n">idIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">additional_info</span><span class="p">[</span><span class="n">keyval</span><span class="p">]</span>								
					<span class="k">else</span><span class="p">:</span>						
						<span class="n">readunit</span><span class="p">[</span><span class="n">keyval</span><span class="p">]</span> <span class="o">=</span> <span class="n">additional_info</span><span class="p">[</span><span class="n">keyval</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
		 		<span class="n">readunit</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">header_line</span>
		<span class="k">return</span> <span class="n">readunit</span>
</div>
<div class="viewcode-block" id="immunogrepFASTA.create"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTA.create">[docs]</a>	<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="o">+</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">())))</span>
</div>
<div class="viewcode-block" id="immunogrepFASTA.write"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTA.write">[docs]</a>	<span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">content</span><span class="p">,</span><span class="n">additionalinfo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s">&quot;Write Error: Content is not conforming to the JSON format!&quot;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&gt;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">fasta_file_delimiter</span><span class="o">+</span><span class="n">additionalinfo</span><span class="p">,</span><span class="n">content</span><span class="p">[</span><span class="s">&#39;sequence&#39;</span><span class="p">]))</span>
</div>
<div class="viewcode-block" id="immunogrepFASTA.close"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTA.close">[docs]</a>	<span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">SeqIOfilehandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">temphandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="immunogrepFASTA.getDecoratorinfo"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTA.getDecoratorinfo">[docs]</a>	<span class="k">def</span> <span class="nf">getDecoratorinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span>
</div>
<div class="viewcode-block" id="immunogrepFASTA.getDescription"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTA.getDescription">[docs]</a>	<span class="k">def</span> <span class="nf">getDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">[</span><span class="n">description_var</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="immunogrepFASTA.getFilelocation"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTA.getFilelocation">[docs]</a>	<span class="k">def</span> <span class="nf">getFilelocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span>
</div>
<div class="viewcode-block" id="immunogrepFASTA.getFiletype"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTA.getFiletype">[docs]</a>	<span class="k">def</span> <span class="nf">getFiletype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span>
</div>
<div class="viewcode-block" id="immunogrepFASTA.getTranslation"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTA.getTranslation">[docs]</a>	<span class="k">def</span> <span class="nf">getTranslation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">()[</span><span class="n">translation_var</span><span class="p">]:</span>
			<span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">()[</span><span class="n">translation_var</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">t</span><span class="o">=</span><span class="bp">None</span>
		<span class="k">return</span> <span class="n">t</span>
		
</div></div>
<div class="viewcode-block" id="immunogrepFASTQ"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTQ">[docs]</a><span class="k">class</span> <span class="nc">immunogrepFASTQ</span><span class="p">():</span>
	<span class="c">#working version 211...</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filelocation</span><span class="p">,</span><span class="n">filetype</span><span class="p">,</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="n">FASTQdecoratorinfo</span><span class="p">,</span><span class="n">contains_header</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">field_names</span><span class="o">=</span><span class="p">[],</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">=</span><span class="n">filelocation</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="n">filetype</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="o">=</span><span class="n">field_names</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">contains_header</span> <span class="o">=</span> <span class="bp">False</span>
		<span class="k">if</span> <span class="n">decoratorinfo</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">tmpline</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
				<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="n">tmpline</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tmpline</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="p">):]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span><span class="s">&#39;&quot;&#39;</span><span class="p">))</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="p">{}</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="n">FASTQdecoratorinfo</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="n">decoratorinfo</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
		<span class="c">#self.SeqIOfilehandle=SeqIO.parse(self.filehandle,&#39;fastq&#39;)</span>
		<span class="c">#By-passing the decorator line if it exists</span>
		
		<span class="bp">self</span><span class="o">.</span><span class="n">temphandle</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
		<span class="n">skip_lines</span> <span class="o">=</span> <span class="mi">0</span>
		
		<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>			
			<span class="n">new_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temphandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
			<span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">new_line</span><span class="p">):</span>
				<span class="k">break</span>
			<span class="k">if</span> <span class="n">new_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;@&#39;</span><span class="p">):</span>
				<span class="k">break</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">skip_lines</span><span class="o">+=</span><span class="mi">1</span>
			<span class="k">if</span> <span class="n">new_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="p">)</span> <span class="ow">or</span> <span class="n">new_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">):</span>
				<span class="k">continue</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;This FASTQ file, &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;, has unusual header lines: &#39;</span><span class="o">+</span><span class="n">new_line</span><span class="p">)</span>
		
		<span class="bp">self</span><span class="o">.</span><span class="n">SeqIOfilehandle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
		
		<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">skip_lines</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">SeqIOfilehandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
					
		
	<span class="c">#	if descriptor_symbol in self.temphandle.readline():</span>
<span class="c">#			#self.SeqIOfilehandle=SeqIO.parse(self.temphandle,&#39;fastq&#39;)</span>
<span class="c">#			self.SeqIOfilehandle=open(self.filelocation,&#39;r&#39;) #SeqIO.parse(self.filelocation,self.mode)</span>
<span class="c">#		else:</span>
<span class="c">#			#self.SeqIOfilehandle=SeqIO.parse(self.filehandle,&#39;fastq&#39;)</span>
<span class="c">#			self.SeqIOfilehandle=open(self.filelocation,&#39;r&#39;) #SeqIO.parse(self.filelocation,self.mode)</span>
		
		<span class="bp">self</span><span class="o">.</span><span class="n">eof</span><span class="o">=</span><span class="bp">False</span>

<div class="viewcode-block" id="immunogrepFASTQ.convert2IF"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTQ.convert2IF">[docs]</a>	<span class="k">def</span> <span class="nf">convert2IF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">==</span><span class="s">&#39;FASTQ&#39;</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">IFExt</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
				<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="o">+</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
				<span class="n">decor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span>
				<span class="n">body</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
				<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">decor</span><span class="p">[</span><span class="n">translation_var</span><span class="p">]:</span>
					<span class="n">body</span><span class="p">[</span><span class="n">decor</span><span class="p">[</span><span class="n">translation_var</span><span class="p">][</span><span class="n">k</span><span class="p">]]</span><span class="o">=</span><span class="s">&#39;&#39;</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
						<span class="k">if</span> <span class="s">&#39;@&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
							<span class="k">if</span> <span class="n">body</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">body</span><span class="p">[</span><span class="s">&#39;sequence&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">body</span><span class="p">[</span><span class="s">&#39;phred&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s">&#39;&#39;</span><span class="p">:</span>
								<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
							<span class="n">body</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
							<span class="n">body</span><span class="p">[</span><span class="s">&#39;sequence&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;&#39;</span>
							<span class="n">body</span><span class="p">[</span><span class="s">&#39;phred&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;&#39;</span>
							<span class="n">plus</span><span class="o">=</span><span class="bp">False</span>
						<span class="k">elif</span> <span class="ow">not</span> <span class="n">plus</span> <span class="ow">and</span> <span class="s">&#39;+&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
							<span class="n">body</span><span class="p">[</span><span class="s">&#39;sequence&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">body</span><span class="p">[</span><span class="s">&#39;sequence&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
						<span class="k">elif</span> <span class="s">&#39;+&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
							<span class="n">plus</span><span class="o">=</span><span class="bp">True</span>
							<span class="k">continue</span>
						<span class="k">elif</span> <span class="n">plus</span><span class="p">:</span>
							<span class="n">body</span><span class="p">[</span><span class="s">&#39;phred&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">body</span><span class="p">[</span><span class="n">decor</span><span class="p">[</span><span class="n">translation_var</span><span class="p">][</span><span class="s">&#39;QUAL_SCORE&#39;</span><span class="p">]]</span><span class="o">+</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
					<span class="k">if</span> <span class="n">body</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">body</span><span class="p">[</span><span class="s">&#39;sequence&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s">&#39;&#39;</span> <span class="ow">and</span> <span class="n">body</span><span class="p">[</span><span class="s">&#39;phred&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s">&#39;&#39;</span><span class="p">:</span>
						<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">IFExt</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;JSON&#39;</span>
	</div>
<div class="viewcode-block" id="immunogrepFASTQ.Extract_Header"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTQ.Extract_Header">[docs]</a>	<span class="k">def</span> <span class="nf">Extract_Header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">linenum</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">readunit</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
			<span class="n">endchk</span><span class="o">=</span><span class="bp">False</span>
			<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
			
			<span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>		
			<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
				<span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_header</span><span class="p">:</span>
					<span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
			
			<span class="n">numSeq</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">fail</span> <span class="o">=</span> <span class="bp">False</span>
			<span class="n">totallines</span><span class="o">=</span><span class="mi">0</span>
			<span class="k">while</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">numSeq</span><span class="o">&lt;</span><span class="n">num_line_search</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">fail</span><span class="p">):</span>
				<span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>			
				<span class="k">if</span> <span class="s">&#39;@&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
					<span class="p">[</span><span class="n">header</span><span class="p">,</span><span class="n">more_fields</span><span class="p">]</span> <span class="o">=</span> <span class="n">GetAdditionalInfo</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>					
					<span class="n">fields</span><span class="o">+=</span><span class="n">more_fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
					<span class="c">#if fasta_file_delimiter in line:</span>
					<span class="c">#	tmp=line.split(fasta_file_delimiter) #if extra info is included in the header, then it is passed using the the fasta_file_delimiter													</span>
					<span class="c">#	additional_info = json.loads(tmp[1])						</span>
					<span class="c">#	fields = fields + additional_info.keys()</span>
					<span class="n">numSeq</span><span class="o">+=</span><span class="mi">1</span>
				<span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
				<span class="n">totallines</span><span class="o">+=</span><span class="mi">1</span>
				<span class="k">if</span> <span class="n">totallines</span> <span class="o">==</span> <span class="n">num_line_search</span><span class="o">*</span><span class="mi">4</span> <span class="ow">and</span> <span class="n">numSeq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
					<span class="n">fail</span> <span class="o">=</span> <span class="bp">True</span>
		
			
			<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			<span class="c">#unique_fields = sorted(set(fields))</span>
			<span class="n">fields</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="s">&#39;header&#39;</span><span class="p">,</span><span class="s">&#39;sequence&#39;</span><span class="p">,</span><span class="s">&#39;phred&#39;</span><span class="p">,</span><span class="s">&#39;document_header&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">))))</span>
		
			<span class="k">if</span> <span class="n">fail</span><span class="p">:</span>
				<span class="k">return</span> <span class="bp">None</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">fields</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">None</span>		
</div>
<div class="viewcode-block" id="immunogrepFASTQ.read"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTQ.read">[docs]</a>	<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">readunit</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>				
				
		<span class="k">try</span><span class="p">:</span>
			<span class="n">line1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SeqIOfilehandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">eof</span><span class="o">=</span><span class="bp">True</span>
			<span class="n">readunit</span><span class="o">=</span><span class="bp">None</span>
		
		<span class="k">if</span> <span class="ow">not</span> <span class="n">line1</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">eof</span><span class="o">=</span><span class="bp">True</span>
			<span class="n">readunit</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="k">else</span><span class="p">:</span>				
			<span class="k">if</span> <span class="n">line1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;@&#39;</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;This does not appear to be a FASTQ sequence as the sequence header does not start with &quot;@&quot;: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line1</span><span class="p">))</span>			
			<span class="n">header</span> <span class="o">=</span> <span class="n">line1</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
			<span class="n">seq</span><span class="o">=</span><span class="s">&#39;&#39;</span>
			<span class="n">next_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SeqIOfilehandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
			<span class="k">while</span> <span class="n">next_line</span><span class="o">!=</span><span class="s">&#39;+&#39;</span><span class="p">:</span>
				<span class="n">seq</span><span class="o">+=</span><span class="n">next_line</span>
				<span class="n">next_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SeqIOfilehandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
			<span class="n">len_seq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
			<span class="n">next_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SeqIOfilehandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
			<span class="n">qual</span><span class="o">=</span><span class="n">next_line</span>
			<span class="n">qual_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">qual</span><span class="p">)</span>			
			<span class="k">while</span> <span class="n">qual_len</span><span class="o">&lt;</span><span class="n">len_seq</span><span class="p">:</span>
				<span class="n">qual</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">SeqIOfilehandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
				<span class="n">qual_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">qual</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">qual_len</span><span class="o">!=</span><span class="n">len_seq</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;The sequence length does not match the length of the quality score for the following sequence: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header</span><span class="p">))</span>
			<span class="c">#line = self.SeqIOfilehandle.next()</span>
		
			
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">eof</span><span class="p">:</span>						
			<span class="n">readunit</span><span class="p">[</span><span class="s">&#39;sequence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">seq</span> <span class="c"># str(line.seq)</span>
			<span class="c">#qualnum=line.letter_annotations[&quot;phred_quality&quot;]</span>
			<span class="c">#readunit[&#39;phred&#39;]=&#39;&#39;</span>
			<span class="c">#for i in qualnum:</span>
			<span class="c">#	readunit[&#39;phred&#39;]=readunit[&#39;phred&#39;]+str(chr(i+33))</span>
			<span class="n">readunit</span><span class="p">[</span><span class="s">&#39;phred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qual</span>
			<span class="n">header_line</span> <span class="o">=</span> <span class="n">header</span> <span class="c">#line.description</span>
			<span class="n">readunit</span><span class="p">[</span><span class="s">&#39;document_header&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">header_line</span>
			<span class="k">if</span> <span class="n">fasta_file_delimiter</span> <span class="ow">in</span> <span class="n">header_line</span><span class="p">:</span>
				<span class="n">tmp</span><span class="o">=</span><span class="n">header_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fasta_file_delimiter</span><span class="p">)</span> <span class="c">#if extra info is included in the header, then it is passed using the the fasta_file_delimiter</span>
				<span class="n">readunit</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>									
				<span class="n">additional_info</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>						
		
				<span class="k">for</span> <span class="n">keyval</span> <span class="ow">in</span> <span class="n">additional_info</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">keyval</span> <span class="o">==</span> <span class="n">idIdentifier</span><span class="p">:</span>
						<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">additional_info</span><span class="p">[</span><span class="n">keyval</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>							
							<span class="n">readunit</span><span class="p">[</span><span class="n">idIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">additional_info</span><span class="p">[</span><span class="n">keyval</span><span class="p">][</span><span class="s">&#39;$oid&#39;</span><span class="p">]</span>
						<span class="k">else</span><span class="p">:</span>							
							<span class="n">readunit</span><span class="p">[</span><span class="n">idIdentifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">additional_info</span><span class="p">[</span><span class="n">keyval</span><span class="p">]</span>								
					<span class="k">else</span><span class="p">:</span>						
						<span class="n">readunit</span><span class="p">[</span><span class="n">keyval</span><span class="p">]</span> <span class="o">=</span> <span class="n">additional_info</span><span class="p">[</span><span class="n">keyval</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
		 		<span class="n">readunit</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">header_line</span>
		<span class="k">return</span> <span class="n">readunit</span>
</div>
<div class="viewcode-block" id="immunogrepFASTQ.create"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTQ.create">[docs]</a>	<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="o">+</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">())))</span>
</div>
<div class="viewcode-block" id="immunogrepFASTQ.write"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTQ.write">[docs]</a>	<span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">content</span><span class="p">,</span><span class="n">additionalinfo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s">&quot;Write Error: Content is not conforming to the JSON format!&quot;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;@</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">+</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">fasta_file_delimiter</span><span class="o">+</span><span class="n">additionalinfo</span><span class="p">,</span><span class="n">content</span><span class="p">[</span><span class="s">&#39;sequence&#39;</span><span class="p">],</span><span class="n">content</span><span class="p">[</span><span class="s">&#39;phred&#39;</span><span class="p">]))</span>
</div>
<div class="viewcode-block" id="immunogrepFASTQ.close"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTQ.close">[docs]</a>	<span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">SeqIOfilehandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">temphandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="immunogrepFASTQ.getDecoratorinfo"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTQ.getDecoratorinfo">[docs]</a>	<span class="k">def</span> <span class="nf">getDecoratorinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span>
</div>
<div class="viewcode-block" id="immunogrepFASTQ.getDescription"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTQ.getDescription">[docs]</a>	<span class="k">def</span> <span class="nf">getDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">[</span><span class="n">description_var</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="immunogrepFASTQ.getFilelocation"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTQ.getFilelocation">[docs]</a>	<span class="k">def</span> <span class="nf">getFilelocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span>
</div>
<div class="viewcode-block" id="immunogrepFASTQ.getFiletype"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTQ.getFiletype">[docs]</a>	<span class="k">def</span> <span class="nf">getFiletype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span>
</div>
<div class="viewcode-block" id="immunogrepFASTQ.getTranslation"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepFASTQ.getTranslation">[docs]</a>	<span class="k">def</span> <span class="nf">getTranslation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">()[</span><span class="n">translation_var</span><span class="p">]:</span>
			<span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">()[</span><span class="n">translation_var</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">t</span><span class="o">=</span><span class="bp">None</span>
		<span class="k">return</span> <span class="n">t</span>
</div></div>
<div class="viewcode-block" id="immunogrepDELIM"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepDELIM">[docs]</a><span class="k">class</span> <span class="nc">immunogrepDELIM</span><span class="p">():</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filelocation</span><span class="p">,</span><span class="n">filetype</span><span class="p">,</span><span class="n">decoratorinfo</span><span class="p">,</span><span class="n">delimiter</span><span class="p">,</span><span class="n">contains_header</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">field_names</span><span class="o">=</span><span class="p">[],</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">=</span><span class="n">filelocation</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="n">filetype</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">contains_header</span><span class="o">=</span><span class="n">contains_header</span>
		<span class="n">descriptorPresent</span> <span class="o">=</span> <span class="bp">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="o">=</span><span class="n">field_names</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span>		
		<span class="k">if</span> <span class="n">decoratorinfo</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">tmpline</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>				
				<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="n">tmpline</span><span class="p">:</span>
					<span class="n">descriptorPresent</span> <span class="o">=</span> <span class="bp">True</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tmpline</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="p">):]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span><span class="s">&#39;&quot;&#39;</span><span class="p">))</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span> <span class="o">=</span> <span class="p">{}</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="p">{}</span>			
		<span class="k">else</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">tmpline</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>				
				<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="n">tmpline</span><span class="p">:</span>
					<span class="n">descriptorPresent</span> <span class="o">=</span> <span class="bp">True</span>				
			<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="n">decoratorinfo</span>
					
		<span class="k">if</span> <span class="n">contains_header</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header_skipped</span> <span class="o">=</span> <span class="bp">False</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">line</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
					<span class="n">line</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
				<span class="n">tmp</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">[</span><span class="n">description_var</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">]</span><span class="c">#filed names detected in file </span>
				<span class="bp">self</span><span class="o">.</span><span class="n">header_names_map</span><span class="o">=</span><span class="p">{</span><span class="n">f</span><span class="p">:</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="p">}</span><span class="c">#dictionary mapping header name to column number</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">maxfields</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>					
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header_skipped</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">maxfields</span><span class="o">=</span><span class="mi">0</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_line_search</span><span class="p">):</span>					
					<span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
					<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
						<span class="k">continue</span>
					<span class="n">tmp</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>
					<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">maxfields</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">maxfields</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
			<span class="n">descriptor</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Column &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxfields</span><span class="p">)]</span><span class="c">#field names detected in file </span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header_names_map</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Column &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxfields</span><span class="p">)}</span><span class="c">#dictionary mapping header name to column number</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">[</span><span class="n">description_var</span><span class="p">]</span><span class="o">=</span><span class="n">descriptor</span>		

		<span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
		
		<span class="c">#if field names were provided, then filter the dictionary header map by field names</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header_names_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">f</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_names_map</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="p">}</span>
		
		<span class="k">if</span> <span class="n">descriptorPresent</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">eof</span><span class="o">=</span><span class="bp">False</span>

<div class="viewcode-block" id="immunogrepDELIM.Extract_Header"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepDELIM.Extract_Header">[docs]</a>	<span class="k">def</span> <span class="nf">Extract_Header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>		
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">[</span><span class="n">description_var</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="immunogrepDELIM.convert2IF"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepDELIM.convert2IF">[docs]</a>	<span class="k">def</span> <span class="nf">convert2IF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">==</span><span class="s">&#39;TAB&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">==</span><span class="s">&#39;CSV&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">==</span><span class="s">&#39;DELIM&#39;</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">IFExt</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
				<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="o">+</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
				<span class="n">decor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span>
				<span class="n">body</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
				<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">decor</span><span class="p">[</span><span class="n">description_var</span><span class="p">]:</span>
					<span class="n">body</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;&#39;</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
					<span class="n">tmpline</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
					<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="n">tmpline</span><span class="p">:</span>
						<span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
					<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_header</span><span class="p">:</span>
						<span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
					<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">line</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">:</span>
							<span class="k">continue</span>
						<span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
						<span class="n">tmp</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="p">)</span>
						<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)):</span>
							<span class="n">body</span><span class="p">[</span><span class="n">decor</span><span class="p">[</span><span class="n">description_var</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
						<span class="n">fout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">IFExt</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;JSON&#39;</span>
</div>
<div class="viewcode-block" id="immunogrepDELIM.read"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepDELIM.read">[docs]</a>	<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	
		<span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">header_skipped</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">header_skipped</span> <span class="o">=</span> <span class="bp">True</span>
							
		<span class="n">line</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
		
		<span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">eof</span><span class="o">=</span><span class="bp">True</span>
			<span class="k">return</span> <span class="bp">None</span>
				
		<span class="n">tmp</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="p">)</span>
		<span class="n">max_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
		<span class="n">readunit</span> <span class="o">=</span> <span class="p">{</span><span class="n">field</span><span class="p">:</span><span class="n">tmp</span><span class="p">[</span><span class="n">col_num</span><span class="p">]</span> <span class="k">if</span> <span class="n">col_num</span> <span class="o">&lt;</span> <span class="n">max_len</span> <span class="k">else</span> <span class="s">&#39;&#39;</span> <span class="k">for</span> <span class="n">field</span><span class="p">,</span><span class="n">col_num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_names_map</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="p">}</span>								
		
		<span class="k">return</span> <span class="n">readunit</span>
</div>
<div class="viewcode-block" id="immunogrepDELIM.create"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepDELIM.create">[docs]</a>	<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="o">+</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">())))</span>
</div>
<div class="viewcode-block" id="immunogrepDELIM.write"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepDELIM.write">[docs]</a>	<span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">content</span><span class="p">,</span><span class="n">additionalinfo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s">&quot;Write Error: Content is not conforming to the JSON format!&quot;</span><span class="p">)</span>
		<span class="n">tmp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">()[</span><span class="n">description_var</span><span class="p">]</span>
		
		<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">body</span><span class="p">:</span>
				<span class="n">body</span><span class="o">=</span><span class="n">content</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">delimiter</span><span class="o">+</span><span class="n">content</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
		<span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="immunogrepDELIM.close"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepDELIM.close">[docs]</a>	<span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="immunogrepDELIM.getDecoratorinfo"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepDELIM.getDecoratorinfo">[docs]</a>	<span class="k">def</span> <span class="nf">getDecoratorinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span>
</div>
<div class="viewcode-block" id="immunogrepDELIM.getDescription"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepDELIM.getDescription">[docs]</a>	<span class="k">def</span> <span class="nf">getDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">[</span><span class="n">description_var</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="immunogrepDELIM.getFilelocation"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepDELIM.getFilelocation">[docs]</a>	<span class="k">def</span> <span class="nf">getFilelocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span>
</div>
<div class="viewcode-block" id="immunogrepDELIM.getFiletype"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepDELIM.getFiletype">[docs]</a>	<span class="k">def</span> <span class="nf">getFiletype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span>
</div>
<div class="viewcode-block" id="immunogrepDELIM.getTranslation"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepDELIM.getTranslation">[docs]</a>	<span class="k">def</span> <span class="nf">getTranslation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">()[</span><span class="n">translation_var</span><span class="p">]:</span>
			<span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">()[</span><span class="n">translation_var</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">t</span><span class="o">=</span><span class="bp">None</span>
		<span class="k">return</span> <span class="n">t</span>
</div></div>
<div class="viewcode-block" id="immunogrepJSON"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepJSON">[docs]</a><span class="k">class</span> <span class="nc">immunogrepJSON</span><span class="p">():</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filelocation</span><span class="p">,</span><span class="n">filetype</span><span class="p">,</span><span class="n">decoratorinfo</span><span class="p">,</span><span class="n">contains_header</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">field_names</span><span class="o">=</span><span class="p">[],</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">=</span><span class="n">filelocation</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="n">filetype</span>
		<span class="n">descriptorPresent</span> <span class="o">=</span> <span class="bp">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="o">=</span><span class="n">field_names</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span>
		<span class="k">if</span> <span class="n">decoratorinfo</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">tmpline</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
				<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="n">tmpline</span><span class="p">:</span>
					<span class="n">descriptorPresent</span> <span class="o">=</span> <span class="bp">True</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tmpline</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="p">):]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span><span class="s">&#39;&quot;&#39;</span><span class="p">))</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="p">{}</span>						
				<span class="k">else</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="p">{}</span>
			<span class="k">if</span> <span class="n">description_var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">[</span><span class="n">description_var</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Extract_Header</span><span class="p">()</span> 
		<span class="k">else</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">tmpline</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>				
				<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="n">tmpline</span><span class="p">:</span>
					<span class="n">descriptorPresent</span> <span class="o">=</span> <span class="bp">True</span>		
			<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="o">=</span><span class="n">decoratorinfo</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">descriptorPresent</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">eof</span><span class="o">=</span><span class="bp">False</span>
	
	
<div class="viewcode-block" id="immunogrepJSON.Extract_Header"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepJSON.Extract_Header">[docs]</a>	<span class="k">def</span> <span class="nf">Extract_Header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">linenum</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">readunit</span><span class="o">=</span><span class="nb">dict</span><span class="p">()</span>
			<span class="n">endchk</span><span class="o">=</span><span class="bp">False</span>
			<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
			<span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>		
			<span class="k">if</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
				<span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>			
			<span class="n">numSeq</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>			
			<span class="k">while</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">numSeq</span><span class="o">&lt;</span><span class="n">num_line_search</span><span class="p">:</span>
				<span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>			
				
				<span class="n">additional_info</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
				<span class="n">fields</span><span class="o">=</span> <span class="n">fields</span><span class="o">+</span><span class="n">additional_info</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
				<span class="n">numSeq</span><span class="o">+=</span><span class="mi">1</span>
				<span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>	
			<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
			
			<span class="n">unique_fields</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">))</span>
			<span class="k">return</span> <span class="n">unique_fields</span>
		<span class="k">except</span><span class="p">:</span>	
			<span class="k">return</span> <span class="bp">None</span>
		</div>
<div class="viewcode-block" id="immunogrepJSON.read"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepJSON.read">[docs]</a>	<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">line</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
		<span class="k">while</span> <span class="n">descriptor_symbol</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
			<span class="n">line</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">eof</span><span class="o">=</span><span class="bp">True</span>
			<span class="k">return</span> <span class="bp">None</span>
		<span class="n">tmp</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">tmp</span>
</div>
<div class="viewcode-block" id="immunogrepJSON.create"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepJSON.create">[docs]</a>	<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">descriptor_symbol</span><span class="o">+</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">())))</span>
</div>
<div class="viewcode-block" id="immunogrepJSON.write"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepJSON.write">[docs]</a>	<span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">content</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s">&quot;Write Error: Content is not conforming to the JSON format!&quot;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="immunogrepJSON.close"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepJSON.close">[docs]</a>	<span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filehandle</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="immunogrepJSON.getDecoratorinfo"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepJSON.getDecoratorinfo">[docs]</a>	<span class="k">def</span> <span class="nf">getDecoratorinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span>
</div>
<div class="viewcode-block" id="immunogrepJSON.getDescription"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepJSON.getDescription">[docs]</a>	<span class="k">def</span> <span class="nf">getDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">[</span><span class="n">description_var</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="immunogrepJSON.getFilelocation"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepJSON.getFilelocation">[docs]</a>	<span class="k">def</span> <span class="nf">getFilelocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span>
</div>
<div class="viewcode-block" id="immunogrepJSON.getFiletype"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepJSON.getFiletype">[docs]</a>	<span class="k">def</span> <span class="nf">getFiletype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetype</span>
</div>
<div class="viewcode-block" id="immunogrepJSON.getTranslation"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepJSON.getTranslation">[docs]</a>	<span class="k">def</span> <span class="nf">getTranslation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">()[</span><span class="n">translation_var</span><span class="p">]:</span>
			<span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">()[</span><span class="n">translation_var</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">t</span><span class="o">=</span><span class="bp">None</span>
		<span class="k">return</span> <span class="n">t</span>

</div></div>
<div class="viewcode-block" id="immunogrepIMGT"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepIMGT">[docs]</a><span class="k">class</span> <span class="nc">immunogrepIMGT</span><span class="p">():</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imgtfiles</span><span class="p">,</span><span class="n">important_headers_only</span> <span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">field_names</span><span class="o">=</span><span class="p">[],</span><span class="n">required_files</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">include_parameters_file</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="o">=</span><span class="n">imgtfiles</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;IMGT&#39;</span>				
		<span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;r&#39;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">required_files</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">required_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">required_files</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">required_files</span> <span class="o">=</span> <span class="n">required_files</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">include_parameters_file</span> <span class="o">=</span> <span class="n">include_parameters_file</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">important_headers_only</span><span class="o">=</span><span class="n">important_headers_only</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">field_names</span> <span class="o">=</span> <span class="n">field_names</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\(([0-9]+)\)&quot;</span><span class="p">)</span> <span class="c">#search for any numbers within &#39;(&#39; and &#39;)&#39; use \( to make string literal</span>
						
		<span class="c">#these are redundant columns in multiple IMGT files </span>
		<span class="bp">self</span><span class="o">.</span><span class="n">identical_fields</span> <span class="o">=</span> <span class="p">[</span>
		<span class="c">#	&#39;Sequence ID&#39;,	</span>
		<span class="c">#	&#39;V-GENE and allele&#39;,</span>
		<span class="c">#	&#39;J-GENE and allele&#39;,</span>
		<span class="c">#	&#39;D-GENE and allele&#39;</span>
		<span class="p">]</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">special_fields</span> <span class="o">=</span> <span class="p">{</span>
			<span class="s">&#39;V-GENE and allele_1&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;, or&#39;</span><span class="p">,</span><span class="s">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; or &#39;</span><span class="p">,</span><span class="s">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;(see comment)&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
			<span class="s">&#39;D-GENE and allele_1&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;, or&#39;</span><span class="p">,</span><span class="s">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; or &#39;</span><span class="p">,</span><span class="s">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;(see comment)&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>		
			<span class="s">&#39;J-GENE and allele_1&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;, or&#39;</span><span class="p">,</span><span class="s">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; or &#39;</span><span class="p">,</span><span class="s">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;(see comment)&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>	
			<span class="s">&#39;CDR1-IMGT_3&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
			<span class="s">&#39;CDR1-IMGT_5&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
			<span class="s">&#39;CDR2-IMGT_3&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
			<span class="s">&#39;CDR2-IMGT_5&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
			<span class="s">&#39;CDR3-IMGT_3&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
			<span class="s">&#39;CDR3-IMGT_5&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
			<span class="s">&#39;FR1-IMGT_3&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
			<span class="s">&#39;FR1-IMGT_5&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
			<span class="s">&#39;FR2-IMGT_3&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
			<span class="s">&#39;FR2-IMGT_5&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
			<span class="s">&#39;FR3-IMGT_3&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
			<span class="s">&#39;FR3-IMGT_5&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>		
			<span class="s">&#39;FR4-IMGT_3&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
			<span class="s">&#39;FR4-IMGT_5&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
			<span class="s">&#39;V-REGION Nb of mutations_8&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pat</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="s">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">else</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
			<span class="s">&#39;V-REGION Nb of AA changes_9&#39;</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pat</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="s">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">else</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>		
		<span class="p">}</span>

		
		<span class="c">#first seperate the provided IMGT files by their file name. </span>
		<span class="c">#group all files from the same original filename together </span>
		<span class="bp">self</span><span class="o">.</span><span class="n">grouped_imgt_files</span> <span class="o">=</span> <span class="n">GroupIMGTFiles</span><span class="p">(</span><span class="n">imgtfiles</span><span class="p">)</span>
		<span class="n">all_field_names</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="c">#go through each IMGT group. Make sure the required files are present</span>
		<span class="k">for</span> <span class="n">each_group</span><span class="p">,</span><span class="n">found_files</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grouped_imgt_files</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>				
			<span class="n">data_to_read</span> <span class="o">=</span> <span class="p">[{}]</span><span class="o">*</span><span class="mi">11</span>						
			<span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">found_files</span><span class="p">:</span><span class="c"># imgtfiles:			</span>
				<span class="c">#go through each of the found files in that group </span>
				<span class="c">#determine each files  file number </span>
				<span class="c">#also make sure to only read in fields requested by user </span>
				<span class="p">[</span><span class="n">filenumber</span><span class="p">,</span><span class="n">fields</span><span class="p">]</span> <span class="o">=</span> <span class="n">find_imgt_file_type_index</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">important_headers_only</span><span class="p">)</span>				
				<span class="k">if</span> <span class="ow">not</span> <span class="n">filenumber</span><span class="p">:</span>				
					<span class="k">continue</span>
				<span class="k">if</span> <span class="n">filenumber</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span>				
					<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_parameters_file</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
						<span class="n">read_fields</span> <span class="o">=</span> <span class="p">[]</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">read_fields</span> <span class="o">=</span> <span class="n">fields</span>				
				<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="p">:</span>											
					<span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">filenumber</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">])</span>
					<span class="c">#only read the intersection of fields  </span>
					<span class="n">read_fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">fields</span><span class="o">&amp;</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field_names</span><span class="p">)</span> <span class="p">)</span>										
				<span class="k">else</span><span class="p">:</span>
					<span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">filenumber</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">])</span>
					<span class="n">read_fields</span> <span class="o">=</span> <span class="n">fields</span>	
				<span class="n">all_field_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">read_fields</span><span class="p">)</span>
				
				<span class="k">if</span> <span class="n">read_fields</span><span class="p">:</span>
					<span class="n">data_to_read</span><span class="p">[</span><span class="n">filenumber</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
																		
			<span class="c">#ENSURE THAT THE REQUIRED IMGT FILES ARE PRESENT		</span>
			<span class="k">for</span> <span class="n">each_required_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_files</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">each_required_file</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">each_required_file</span><span class="o">&lt;=</span><span class="mi">11</span><span class="p">:</span>
					<span class="c">#user requested that specific IMGT file is required for reading </span>
					<span class="k">if</span> <span class="n">data_to_read</span><span class="p">[</span><span class="n">each_required_file</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="p">{}:</span>
						<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;IMGT File {0} from {1} is required&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">each_required_file</span><span class="p">),</span><span class="n">each_group</span><span class="p">))</span>				
				
		
		<span class="c">#ITS IMGT so we already know what to expect </span>
		<span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span> <span class="o">=</span> <span class="p">{</span>
			<span class="n">description_var</span><span class="p">:</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_field_names</span><span class="p">))),</span>
			<span class="n">translation_var</span><span class="p">:</span><span class="n">imgt_db_translator</span>
		<span class="p">}</span>
					
		<span class="bp">self</span><span class="o">.</span><span class="n">eof</span><span class="o">=</span><span class="bp">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">my_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IMGT_Reader_Gen</span><span class="p">()</span>
	
<div class="viewcode-block" id="immunogrepIMGT.CheckForDBID"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepIMGT.CheckForDBID">[docs]</a>	<span class="k">def</span> <span class="nf">CheckForDBID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sequence_header</span><span class="p">):</span>	
		<span class="n">additional_info</span> <span class="o">=</span> <span class="p">{}</span>
		<span class="k">if</span> <span class="n">fasta_file_delimiter</span> <span class="ow">in</span> <span class="n">sequence_header</span><span class="p">:</span>		
			<span class="n">tmp</span><span class="o">=</span><span class="n">sequence_header</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fasta_file_delimiter</span><span class="p">)</span> <span class="c">#if extra info is included in the header, then it is passed using the the fasta_file_delimiter</span>
			<span class="n">sequence_header</span><span class="o">=</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>					
			<span class="k">try</span><span class="p">:</span>
				<span class="n">additional_info</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="c">#usually occurs if sequence header is truncated </span>
				<span class="n">additional_info</span> <span class="o">=</span> <span class="p">{}</span>
			
		<span class="k">return</span> <span class="n">additional_info</span>	<span class="c">#if the ID idnetifier was included form th atabase then it will be in this dict</span>

	</div>
<div class="viewcode-block" id="immunogrepIMGT.treat_these_fields_specially"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepIMGT.treat_these_fields_specially">[docs]</a>	<span class="k">def</span> <span class="nf">treat_these_fields_specially</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>	
		<span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">special_fields</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">special_fields</span><span class="p">[</span><span class="n">key</span><span class="p">](</span><span class="n">value</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="immunogrepIMGT.treat_these_fields_specially2"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepIMGT.treat_these_fields_specially2">[docs]</a>	<span class="k">def</span> <span class="nf">treat_these_fields_specially2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">key</span><span class="o">==</span><span class="s">&#39;V-GENE and allele_1&#39;</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;D-GENE and allele_1&#39;</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&#39;J-GENE and allele_1&#39;</span><span class="p">:</span>	
			<span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;, or&#39;</span><span class="p">,</span><span class="s">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; or &#39;</span><span class="p">,</span><span class="s">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;(see comment)&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">),</span>
		<span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;CDR1-IMGT_3&#39;</span><span class="p">,</span><span class="s">&#39;CDR2-IMGT_3&#39;</span><span class="p">,</span><span class="s">&#39;CDR3-IMGT_3&#39;</span><span class="p">,</span><span class="s">&#39;FR1-IMGT_3&#39;</span><span class="p">,</span><span class="s">&#39;FR2-IMGT_3&#39;</span><span class="p">,</span><span class="s">&#39;FR3-IMGT_3&#39;</span><span class="p">,</span><span class="s">&#39;CDR1-IMGT_5&#39;</span><span class="p">,</span><span class="s">&#39;CDR2-IMGT_5&#39;</span><span class="p">,</span><span class="s">&#39;CDR3-IMGT_5&#39;</span><span class="p">,</span><span class="s">&#39;FR1-IMGT_5&#39;</span><span class="p">,</span><span class="s">&#39;FR2-IMGT_5&#39;</span><span class="p">,</span><span class="s">&#39;FR3-IMGT_5&#39;</span><span class="p">]:</span>
			<span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;V-REGION Nb of mutations_8&#39;</span><span class="p">,</span><span class="s">&#39;V-REGION Nb of AA changes_9&#39;</span><span class="p">]:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pat</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="s">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">value</span> <span class="k">else</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">value</span>
	
	</div>
<div class="viewcode-block" id="immunogrepIMGT.Extract_Header"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepIMGT.Extract_Header">[docs]</a>	<span class="k">def</span> <span class="nf">Extract_Header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">[</span><span class="n">description_var</span><span class="p">]</span>	
		</div>
<div class="viewcode-block" id="immunogrepIMGT.read"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepIMGT.read">[docs]</a>	<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
				
		<span class="k">try</span><span class="p">:</span>
			<span class="n">readunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_gen</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
		<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
			<span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>				
				<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unexpected error reading imgt file: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
			<span class="n">readunit</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">eof</span><span class="o">=</span><span class="bp">True</span>
		<span class="k">return</span> <span class="n">readunit</span>
			
		
	<span class="c">#def close(self):		</span>
	<span class="c">#	self.filehandle.close()</span>
</div>
<div class="viewcode-block" id="immunogrepIMGT.getDecoratorinfo"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepIMGT.getDecoratorinfo">[docs]</a>	<span class="k">def</span> <span class="nf">getDecoratorinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span>
</div>
<div class="viewcode-block" id="immunogrepIMGT.getDescription"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepIMGT.getDescription">[docs]</a>	<span class="k">def</span> <span class="nf">getDescription</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoratorinfo</span><span class="p">[</span><span class="n">description_var</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="immunogrepIMGT.getFilelocation"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepIMGT.getFilelocation">[docs]</a>	<span class="k">def</span> <span class="nf">getFilelocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span>
</div>
<div class="viewcode-block" id="immunogrepIMGT.getFiletype"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepIMGT.getFiletype">[docs]</a>	<span class="k">def</span> <span class="nf">getFiletype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="s">&#39;IMGT&#39;</span>
</div>
<div class="viewcode-block" id="immunogrepIMGT.getTranslation"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepIMGT.getTranslation">[docs]</a>	<span class="k">def</span> <span class="nf">getTranslation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">()[</span><span class="n">translation_var</span><span class="p">]:</span>
			<span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getDecoratorinfo</span><span class="p">()[</span><span class="n">translation_var</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">t</span><span class="o">=</span><span class="bp">None</span>
		<span class="k">return</span> <span class="n">t</span>
		</div>
<div class="viewcode-block" id="immunogrepIMGT.IMGT_Reader_Gen"><a class="viewcode-back" href="../IGfile.html#immunogrep_read_file.immunogrepIMGT.IMGT_Reader_Gen">[docs]</a>	<span class="k">def</span> <span class="nf">IMGT_Reader_Gen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>		
		<span class="n">include_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_names</span>
		 
		<span class="c">#first seperate the provided IMGT files by their file name. </span>
		<span class="c">#group all files from the same original filename together </span>
		<span class="n">grouped_imgt_files</span> <span class="o">=</span> <span class="n">GroupIMGTFiles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filelocation</span><span class="p">)</span>
		
		<span class="c">#next make sure all the required fieldnames are present </span>
		<span class="n">add_fields</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">if</span> <span class="s">&#39;PREDICTED_AB_SEQ.NT&#39;</span> <span class="ow">in</span> <span class="n">include_fields</span><span class="p">:</span>
			<span class="n">add_fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;V-D-J-REGION_3&#39;</span><span class="p">,</span><span class="s">&#39;V-J-REGION_3&#39;</span><span class="p">])</span> <span class="c">#these fields from IGMT files will be required to make PREDICTED_AB_SEQ.NT</span>
		<span class="k">if</span> <span class="s">&#39;PREDICTED_AB_SEQ.AA&#39;</span> <span class="ow">in</span> <span class="n">include_fields</span><span class="p">:</span>
			<span class="n">add_fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;V-D-J-REGION_5&#39;</span><span class="p">,</span><span class="s">&#39;V-J-REGION_5&#39;</span><span class="p">])</span>
		
		<span class="k">if</span> <span class="s">&#39;VREGION.SHM.NT_PER&#39;</span> <span class="ow">in</span> <span class="n">include_fields</span><span class="p">:</span>
			<span class="n">add_fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;V-REGION identity %_1&#39;</span><span class="p">])</span>
		<span class="k">if</span> <span class="s">&#39;JREGION.SHM.NT_PER&#39;</span> <span class="ow">in</span> <span class="n">include_fields</span><span class="p">:</span>
			<span class="n">add_fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;J-REGION identity %_1&#39;</span><span class="p">])</span>
		
		<span class="k">if</span> <span class="s">&#39;VREGION.SHM.NT&#39;</span> <span class="ow">in</span> <span class="n">include_fields</span><span class="p">:</span>
			<span class="n">add_fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;V-REGION identity nt_1&#39;</span><span class="p">])</span>
		
		<span class="k">if</span> <span class="s">&#39;JREGION.SHM.NT&#39;</span> <span class="ow">in</span> <span class="n">include_fields</span><span class="p">:</span>
			<span class="n">add_fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;J-REGION identity nt_1&#39;</span><span class="p">])</span>
		
		<span class="k">if</span> <span class="s">&#39;VREGION.SHM.AA&#39;</span> <span class="ow">in</span> <span class="n">include_fields</span> <span class="ow">or</span> <span class="s">&#39;VREGION.SHM.AA_PER&#39;</span> <span class="ow">in</span> <span class="n">include_fields</span><span class="p">:</span>
			<span class="n">add_fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;CDR3-IMGT Nb of AA_9&#39;</span><span class="p">,</span><span class="s">&#39;CDR3-IMGT Nb of AA changes_9&#39;</span><span class="p">,</span><span class="s">&#39;V-REGION Nb of AA_9&#39;</span><span class="p">,</span><span class="s">&#39;V-REGION Nb of AA changes_9&#39;</span><span class="p">])</span>
		
		<span class="k">for</span> <span class="n">new_fields</span> <span class="ow">in</span> <span class="n">add_fields</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">new_fields</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">include_fields</span><span class="p">:</span>
				<span class="n">include_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_fields</span><span class="p">)</span>
		
		<span class="c">#read results from each IMGT &#39;group&#39;</span>
		<span class="k">for</span> <span class="n">each_group</span><span class="p">,</span><span class="n">found_files</span> <span class="ow">in</span> <span class="n">grouped_imgt_files</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>			
		
			<span class="n">data_to_read</span> <span class="o">=</span> <span class="p">[{}]</span><span class="o">*</span><span class="mi">11</span>				
			
			<span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">found_files</span><span class="p">:</span><span class="c"># imgtfiles:</span>
			
				<span class="c">#go through each of the found files in that group </span>
				<span class="c">#determine each files  file number </span>
				<span class="c">#also make sure to only read in fields requested by user </span>
				<span class="p">[</span><span class="n">filenumber</span><span class="p">,</span><span class="n">fields</span><span class="p">]</span> <span class="o">=</span> <span class="n">find_imgt_file_type_index</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">important_headers_only</span><span class="p">)</span>				
				<span class="k">if</span> <span class="ow">not</span> <span class="n">filenumber</span><span class="p">:</span>				
					<span class="k">continue</span>
				<span class="k">if</span> <span class="n">filenumber</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span>				
					<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_parameters_file</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
						<span class="n">read_fields</span> <span class="o">=</span> <span class="p">[]</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">read_fields</span> <span class="o">=</span> <span class="n">fields</span>				
				<span class="k">elif</span> <span class="n">include_fields</span><span class="p">:</span>												
					<span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">f</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">filenumber</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">])</span>
					<span class="c">#only read the intersection of fields  </span>
					<span class="n">read_fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">fields</span><span class="o">&amp;</span><span class="nb">set</span><span class="p">(</span><span class="n">include_fields</span><span class="p">)</span> <span class="p">)</span>
					
					<span class="c">#now that we have the intersection, remove the file number that was appended to fields </span>
					<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">rf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">read_fields</span><span class="p">):</span>
						<span class="n">read_fields</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">read_fields</span> <span class="o">=</span> <span class="n">fields</span>
					
					
				<span class="c">#pprint(read_fields)</span>
				<span class="c">#if we are reading fields from this file, then add to the list of files to read </span>
				<span class="k">if</span> <span class="n">read_fields</span><span class="p">:</span>
					<span class="n">data_to_read</span><span class="p">[</span><span class="n">filenumber</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
						<span class="s">&#39;filenum&#39;</span><span class="p">:</span> <span class="n">filenumber</span><span class="p">,</span>
						<span class="s">&#39;fields&#39;</span><span class="p">:</span><span class="n">read_fields</span><span class="p">,</span>
						<span class="s">&#39;filepath&#39;</span><span class="p">:</span><span class="nb">file</span><span class="p">,</span>				
						<span class="s">&#39;file_reader&#39;</span><span class="p">:</span><span class="n">immunogrepFile</span><span class="p">(</span><span class="n">filelocation</span> <span class="o">=</span> <span class="nb">file</span><span class="p">,</span><span class="n">filetype</span><span class="o">=</span><span class="s">&#39;TAB&#39;</span><span class="p">,</span><span class="n">field_names</span><span class="o">=</span><span class="n">read_fields</span><span class="p">)</span>				
					<span class="p">}</span>		
						
					
			<span class="c">#ENSURE THAT THE REQUIRED IMGT FILES ARE PRESENT			</span>
			<span class="k">for</span> <span class="n">each_required_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_files</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">each_required_file</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">each_required_file</span><span class="o">&lt;=</span><span class="mi">11</span><span class="p">:</span>
					<span class="c">#user requested that specific IMGT file is required for reading </span>
					<span class="k">if</span> <span class="n">data_to_read</span><span class="p">[</span><span class="n">each_required_file</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="p">{}:</span>
						<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;IMGT File {0} from {1} is required&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">each_required_file</span><span class="p">),</span><span class="n">each_group</span><span class="p">))</span>
			
			<span class="n">command_settings_keys</span> <span class="o">=</span> <span class="p">{</span>
				<span class="s">&#39;IMGT/V-QUEST programme version&#39;</span><span class="p">:</span><span class="s">&#39;Version&#39;</span><span class="p">,</span>
				<span class="s">&#39;IMGT/V-QUEST reference directory release&#39;</span><span class="p">:</span><span class="s">&#39;Database release&#39;</span><span class="p">,</span>
				<span class="s">&#39;Species&#39;</span><span class="p">:</span><span class="s">&#39;Species&#39;</span><span class="p">,</span>
				<span class="s">&#39;Receptor type or locus&#39;</span><span class="p">:</span><span class="s">&#39;Receptor or locus&#39;</span><span class="p">,</span>
				<span class="s">&#39;IMGT/V-QUEST reference directory set&#39;</span><span class="p">:</span><span class="s">&#39;Database set&#39;</span><span class="p">,</span>
				<span class="s">&#39;Search for insertions and deletions&#39;</span><span class="p">:</span><span class="s">&#39;Search for insertions and deletions&#39;</span>
				<span class="p">}</span>
			<span class="c">#uppercase </span>
			<span class="n">command_settings_keys</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span><span class="n">val</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">command_settings_keys</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()}</span>
			
			<span class="c">#check if file 11 exists</span>
			<span class="n">command</span><span class="o">=</span><span class="s">&#39;&#39;</span>
			<span class="c">#print command_settings_keys</span>
			<span class="k">if</span> <span class="n">data_to_read</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_to_read</span><span class="p">[</span><span class="mi">10</span><span class="p">][</span><span class="s">&#39;filepath&#39;</span><span class="p">],</span><span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
					<span class="n">command_lines</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
				<span class="k">for</span> <span class="n">each_command</span> <span class="ow">in</span> <span class="n">command_lines</span><span class="p">:</span>
					<span class="n">settings</span> <span class="o">=</span> <span class="n">each_command</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
					<span class="c">#column1 = &gt; command/name/field/setting</span>
					<span class="c">#column2 = &gt; value			</span>
					<span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39; </span><span class="se">\r\t\n</span><span class="s">:&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">command_settings_keys</span> <span class="ow">and</span> <span class="n">settings</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>				
						<span class="c">#if we find the command we we want to store in the file and the second column is not empty, then add to command string </span>
						<span class="n">command</span><span class="o">+=</span><span class="n">command_settings_keys</span><span class="p">[</span><span class="n">settings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39; </span><span class="se">\r\t\n</span><span class="s">:&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">settings</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;;&#39;</span>
														
			<span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
			
			<span class="n">at_least_one_file_open</span> <span class="o">=</span> <span class="bp">True</span>
			<span class="k">while</span> <span class="n">at_least_one_file_open</span><span class="p">:</span>
				<span class="n">row_data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">str</span><span class="p">,{})</span>
				
				<span class="n">at_least_one_file_open</span> <span class="o">=</span> <span class="bp">False</span><span class="c">#if all files are eof, then thsi will be false at t thend of loop</span>
				<span class="k">for</span> <span class="n">files_dict</span> <span class="ow">in</span> <span class="n">data_to_read</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]:</span>		
					
					<span class="k">if</span> <span class="ow">not</span> <span class="n">files_dict</span><span class="p">:</span>				
						<span class="k">continue</span>
					
					<span class="n">filenumber</span> <span class="o">=</span> <span class="n">files_dict</span><span class="p">[</span><span class="s">&#39;filenum&#39;</span><span class="p">]</span>
					<span class="k">if</span> <span class="n">filenumber</span><span class="o">&lt;</span><span class="mi">10</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">files_dict</span><span class="p">[</span><span class="s">&#39;file_reader&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">IFclass</span><span class="o">.</span><span class="n">eof</span><span class="p">:</span>								
						<span class="n">at_least_one_file_open</span> <span class="o">=</span> <span class="bp">True</span>
						<span class="n">current_file_data</span> <span class="o">=</span> <span class="n">files_dict</span><span class="p">[</span><span class="s">&#39;file_reader&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">IFclass</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>				
						<span class="k">if</span> <span class="n">current_file_data</span><span class="p">:</span>					
							<span class="k">for</span> <span class="n">each_field</span><span class="p">,</span><span class="n">each_value</span> <span class="ow">in</span> <span class="n">current_file_data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
								<span class="k">if</span> <span class="n">each_field</span> <span class="ow">in</span> <span class="n">files_dict</span><span class="p">[</span><span class="s">&#39;fields&#39;</span><span class="p">]:</span>
									<span class="k">if</span> <span class="n">each_field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">identical_fields</span><span class="p">:</span>								
										<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">each_field</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">filenumber</span><span class="p">))]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">treat_these_fields_specially</span><span class="p">(</span><span class="n">each_field</span><span class="p">,</span><span class="n">each_value</span><span class="p">)</span>							
										<span class="c">#row_data[&#39;{0}&#39;.format(each_field,str(filenumber))] = each_value#treat_these_fields_specially(each_field,each_value)							</span>
									<span class="k">else</span><span class="p">:</span>								
										<span class="c">#row_data[&#39;{0}_{1}&#39;.format(each_field,str(filenumber))] = each_value#treat_these_fields_specially(each_field,each_value)							</span>
										<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;{0}_{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">each_field</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">filenumber</span><span class="p">))]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">treat_these_fields_specially</span><span class="p">(</span><span class="n">each_field</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">filenumber</span><span class="p">),</span><span class="n">each_value</span><span class="p">)</span>							
				
				<span class="k">if</span> <span class="n">at_least_one_file_open</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>					
					<span class="k">continue</span>
				
				<span class="k">if</span> <span class="s">&#39;V-D-J-REGION_3&#39;</span> <span class="ow">in</span> <span class="n">row_data</span><span class="p">:</span>
					<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;PREDICTED_AB_SEQ.NT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;V-D-J-REGION_3&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;V-D-J-REGION_3&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;V-J-REGION_3&#39;</span><span class="p">]</span>			
				<span class="k">if</span> <span class="s">&#39;V-D-J-REGION_5&#39;</span> <span class="ow">in</span> <span class="n">row_data</span><span class="p">:</span>
					<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;PREDICTED_AB_SEQ.AA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;V-D-J-REGION_5&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;V-D-J-REGION_5&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;V-J-REGION_5&#39;</span><span class="p">]</span>		
				<span class="k">if</span> <span class="s">&#39;Sequence ID&#39;</span> <span class="ow">in</span> <span class="n">row_data</span><span class="p">:</span> <span class="c">#extract any other information included in sequence header including database key information</span>
					<span class="n">more_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CheckForDBID</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s">&#39;Sequence ID&#39;</span><span class="p">])</span>
					<span class="n">row_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">row_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span><span class="o">+</span><span class="n">more_fields</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
				
												
				
				<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;VREGION.SHM.NT_PER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
				<span class="k">if</span> <span class="s">&#39;V-REGION identity %_1&#39;</span> <span class="ow">in</span> <span class="n">row_data</span> <span class="ow">and</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;V-REGION identity %_1&#39;</span><span class="p">]:</span>												
					<span class="k">try</span><span class="p">:</span>
						<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;VREGION.SHM.NT_PER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s">&#39;V-REGION identity %_1&#39;</span><span class="p">])</span>					
					<span class="k">except</span><span class="p">:</span>					
						<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;VREGION.SHM.NT_PER&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;&#39;</span>
				
				<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;VREGION.SHM.NT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
				
				<span class="k">if</span> <span class="s">&#39;V-REGION identity nt_1&#39;</span> <span class="ow">in</span> <span class="n">row_data</span> <span class="ow">and</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;V-REGION identity nt_1&#39;</span><span class="p">]:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">match_vals</span> <span class="o">=</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;V-REGION identity nt_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
						<span class="n">match_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
						<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;VREGION.SHM.NT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">match_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
					<span class="k">except</span><span class="p">:</span>					
						<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;VREGION.SHM.NT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
				
	
				<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;JREGION.SHM.NT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
				
				<span class="k">if</span> <span class="s">&#39;J-REGION identity nt_1&#39;</span> <span class="ow">in</span> <span class="n">row_data</span> <span class="ow">and</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;J-REGION identity nt_1&#39;</span><span class="p">]:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">match_vals</span> <span class="o">=</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;J-REGION identity nt_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
						<span class="n">match_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
						<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;JREGION.SHM.NT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">match_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;JREGION.SHM.NT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
										
	
				<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;JREGION.SHM.NT_PER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
				<span class="k">if</span> <span class="s">&#39;J-REGION identity %_1&#39;</span> <span class="ow">in</span> <span class="n">row_data</span> <span class="ow">and</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;J-REGION identity %_1&#39;</span><span class="p">]:</span>								
					<span class="k">try</span><span class="p">:</span>
						<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;JREGION.SHM.NT_PER&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">100</span><span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s">&#39;J-REGION identity %_1&#39;</span><span class="p">])</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;JREGION.SHM.NT_PER&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;&#39;</span>					
				
							
				<span class="k">try</span><span class="p">:</span>
					
					<span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;CDR3-IMGT Nb of AA_9&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;-&#39;</span><span class="p">:</span>					
						<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;CDR3-IMGT Nb of AA_9&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span>
					<span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;CDR3-IMGT Nb of AA changes_9&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;-&#39;</span><span class="p">:</span>					
						<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;CDR3-IMGT Nb of AA changes_9&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span>
									
					<span class="n">num_aa_v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s">&#39;V-REGION Nb of AA_9&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s">&#39;CDR3-IMGT Nb of AA_9&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
					<span class="n">num_aa_mismatch</span> <span class="o">=</span>  <span class="nb">float</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s">&#39;V-REGION Nb of AA changes_9&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s">&#39;CDR3-IMGT Nb of AA changes_9&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
					<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;VREGION.SHM.AA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_aa_mismatch</span>
					<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;VREGION.SHM.AA_PER&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">num_aa_mismatch</span><span class="o">/</span><span class="n">num_aa_v</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
				<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>				
					<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;VREGION.SHM.AA_PER&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;&#39;</span>
					<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;VREGION.SHM.AA&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;&#39;</span>
				
				
				<span class="c">#add recombination_type to fields </span>
				<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;R_TYPE&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s">&#39;VDJ&#39;</span> <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;V-D-J-REGION_3&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="p">(</span><span class="s">&#39;VJ&#39;</span> <span class="k">if</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;V-J-REGION_3&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="p">(</span><span class="s">&#39;&#39;</span> <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">row_data</span><span class="p">[</span><span class="s">&#39;V-GENE and allele_1&#39;</span><span class="p">])</span> <span class="k">else</span> <span class="p">(</span><span class="s">&#39;VDJ&#39;</span> <span class="k">if</span> <span class="p">(</span><span class="s">&#39;IGHV&#39;</span> <span class="ow">in</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;V-GENE and allele_1&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;TRBV&#39;</span> <span class="ow">in</span> <span class="n">row_data</span><span class="p">[</span><span class="s">&#39;V-GENE and allele_1&#39;</span><span class="p">])</span> <span class="k">else</span> <span class="s">&#39;VJ&#39;</span><span class="p">)))</span>
				
				
				<span class="k">if</span> <span class="n">command</span><span class="p">:</span>
					<span class="n">row_data</span><span class="p">[</span><span class="s">&#39;COMMAND&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">command</span>
				<span class="c">#if &#39;Sequence ID_3&#39; in row_data:</span>
				<span class="c">#	more_fields = CheckForDBID(row_data[&#39;Sequence ID_3&#39;])</span>
				<span class="c">#	row_data = dict(row_data.items()+more_fields.items())</span>
				<span class="c">#if &#39;Sequence ID_8&#39; in row_data:</span>
				<span class="c">#	more_fields = CheckForDBID(row_data[&#39;Sequence ID_8&#39;])</span>
				<span class="c">#	row_data = dict(row_data.items()+more_fields.items())				</span>
				<span class="k">if</span> <span class="n">row_data</span><span class="p">:</span>
					<span class="k">yield</span> <span class="n">row_data</span>
	
		
		</div></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Costas.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>